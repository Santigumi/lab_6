/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var t={171:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),s=n.n(r),i=n(314),o=n.n(i)()(s());o.push([t.id,"* {\n    margin: 5px;\n    font-family: Arial, Helvetica, sans-serif;\n}\n\nimg {\n    width: 275px;\n    height: 250px;\n    border-radius: 10px;\n}\n",""]);const a=o},523:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),s=n.n(r),i=n(314),o=n.n(i)()(s());o.push([t.id,"body{\n    display: flex;\n    flex-direction: column;\n    font-family: Arial, Helvetica, sans-serif;\n}\n\ninput{\n    width: 105px;\n    height: 45px;\n    font-size: medium;\n    border-radius: 10px;\n    border-color: lightpink;\n    margin: 5px;\n}\n\nlabel {\n    font-family: Arial, Helvetica, sans-serif;\n    font-size: medium;\n}\n\nbutton {\n    font-size: medium;\n    width: 95px;\n    height: 45px;\n    background-color: lightcoral;\n    color: white;\n    border-radius: 10px;\n    margin: 5px;\n    cursor: pointer;\n}\n\nsection {\ndisplay: grid;\ngrid-template-columns: 325px 325px 325px;\nwidth: 100wh;\nheight: 100vh;\nbackground-color: lightblue;\n}\n\napp-song {\n    display: grid;\n    background-color: lightcoral;\n    width: 295px;\n    height: 450px;\n    border-radius: 10px;\n    color: white\n}\n\n",""]);const a=o},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,r,s,i){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var h=0;h<t.length;h++){var u=[].concat(t[h]);r&&o[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),s&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=s):u[4]="".concat(s)),e.push(u))}},e}},601:t=>{t.exports=function(t){return t[1]}}},e={};function n(r){var s=e[r];if(void 0!==s)return s.exports;var i=e[r]={id:r,exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const t=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},e={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const s=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,h=s>>2,u=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),r.push(n[h],n[u],n[l],n[d])}return r.join("")},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(t(e),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==o||null==a||null==c)throw new r;const h=i<<2|o>>4;if(s.push(h),64!==a){const t=o<<4&240|a>>2;if(s.push(t),64!==c){const t=a<<6&192|c;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(n){return function(n){const r=t(n);return e.encodeByteArray(r,!0)}(n).replace(/\./g,"")},i=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const n=t&&function(t){try{return e.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return n&&JSON.parse(n)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=i())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function h(){try{return"object"==typeof indexedDB}catch(t){return!1}}class u extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,u.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,l.prototype.create)}}class l{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,s=this.errors[t],i=s?function(t,e){return t.replace(d,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new u(r,o,n)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(p(n)&&p(i)){if(!f(n,i))return!1}else if(n!==i)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function p(t){return null!==t&&"object"==typeof t}function g(t){return t&&t._delegate?t._delegate:t}class m{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const y="[DEFAULT]";class v{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:y})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=y){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=y){return this.instances.has(t)}getOptions(t=y){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===y?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=y){return this.component?this.component.multipleInstances?t:y:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class w{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new v(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const E=[];var b;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(b||(b={}));const _={debug:b.DEBUG,verbose:b.VERBOSE,info:b.INFO,warn:b.WARN,error:b.ERROR,silent:b.SILENT},T=b.INFO,S={[b.DEBUG]:"log",[b.VERBOSE]:"log",[b.INFO]:"info",[b.WARN]:"warn",[b.ERROR]:"error"},I=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),s=S[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${r}]  ${t.name}:`,...n)};class C{constructor(t){this.name=t,this._logLevel=T,this._logHandler=I,this._userLogHandler=null,E.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in b))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?_[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,b.DEBUG,...t),this._logHandler(this,b.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,b.VERBOSE,...t),this._logHandler(this,b.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,b.INFO,...t),this._logHandler(this,b.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,b.WARN,...t),this._logHandler(this,b.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,b.ERROR,...t),this._logHandler(this,b.ERROR,...t)}}const A=(t,e)=>e.some((e=>t instanceof e));let D,N;const k=new WeakMap,x=new WeakMap,R=new WeakMap,L=new WeakMap,O=new WeakMap;let M={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return x.get(t);if("objectStoreNames"===e)return t.objectStoreNames||R.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return V(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function P(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(N||(N=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(F(this),t),V(k.get(this))}:function(...t){return V(e.apply(F(this),t))}:function(t,...n){const r=e.call(F(this),t,...n);return R.set(r,t.sort?t.sort():[t]),V(r)}:(t instanceof IDBTransaction&&function(t){if(x.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)}));x.set(t,e)}(t),A(t,D||(D=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,M):t);var e}function V(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(V(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&k.set(e,t)})).catch((()=>{})),O.set(e,t),e}(t);if(L.has(t))return L.get(t);const e=P(t);return e!==t&&(L.set(t,e),O.set(e,t)),e}const F=t=>O.get(t),U=["get","getKey","getAll","getAllKeys","count"],B=["put","add","delete","clear"],j=new Map;function q(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(j.get(e))return j.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=B.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!U.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&i.done]))[0]};return j.set(e,i),i}var $;$=M,M={...$,get:(t,e,n)=>q(t,e)||$.get(t,e,n),has:(t,e)=>!!q(t,e)||$.has(t,e)};class z{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const K="@firebase/app",G="0.9.26",H=new C("@firebase/app"),Q="@firebase/app-compat",W="@firebase/analytics-compat",X="@firebase/analytics",Y="@firebase/app-check-compat",J="@firebase/app-check",Z="@firebase/auth",tt="@firebase/auth-compat",et="@firebase/database",nt="@firebase/database-compat",rt="@firebase/functions",st="@firebase/functions-compat",it="@firebase/installations",ot="@firebase/installations-compat",at="@firebase/messaging",ct="@firebase/messaging-compat",ht="@firebase/performance",ut="@firebase/performance-compat",lt="@firebase/remote-config",dt="@firebase/remote-config-compat",ft="@firebase/storage",pt="@firebase/storage-compat",gt="@firebase/firestore",mt="@firebase/firestore-compat",yt="firebase",vt="[DEFAULT]",wt={[K]:"fire-core",[Q]:"fire-core-compat",[X]:"fire-analytics",[W]:"fire-analytics-compat",[J]:"fire-app-check",[Y]:"fire-app-check-compat",[Z]:"fire-auth",[tt]:"fire-auth-compat",[et]:"fire-rtdb",[nt]:"fire-rtdb-compat",[rt]:"fire-fn",[st]:"fire-fn-compat",[it]:"fire-iid",[ot]:"fire-iid-compat",[at]:"fire-fcm",[ct]:"fire-fcm-compat",[ht]:"fire-perf",[ut]:"fire-perf-compat",[lt]:"fire-rc",[dt]:"fire-rc-compat",[ft]:"fire-gcs",[pt]:"fire-gcs-compat",[gt]:"fire-fst",[mt]:"fire-fst-compat","fire-js":"fire-js",[yt]:"fire-js-all"},Et=new Map,bt=new Map;function _t(t,e){try{t.container.addComponent(e)}catch(n){H.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Tt(t){const e=t.name;if(bt.has(e))return H.debug(`There were multiple attempts to register component ${e}.`),!1;bt.set(e,t);for(const e of Et.values())_t(e,t);return!0}const St=new l("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class It{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new m("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw St.create("app-deleted",{appName:this._name})}}function Ct(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:vt,automaticDataCollectionEnabled:!1},e),s=r.name;if("string"!=typeof s||!s)throw St.create("bad-app-name",{appName:String(s)});if(n||(n=o()),!n)throw St.create("no-options");const i=Et.get(s);if(i){if(f(n,i.options)&&f(r,i.config))return i;throw St.create("duplicate-app",{appName:s})}const a=new w(s);for(const t of bt.values())a.addComponent(t);const c=new It(n,r,a);return Et.set(s,c),c}function At(t,e,n){var r;let s=null!==(r=wt[t])&&void 0!==r?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const t=[`Unable to register library "${s}" with version "${e}":`];return i&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void H.warn(t.join(" "))}Tt(new m(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const Dt="firebase-heartbeat-database",Nt=1,kt="firebase-heartbeat-store";let xt=null;function Rt(){return xt||(xt=function(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=V(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(V(o.result),t.oldVersion,t.newVersion,V(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{i&&t.addEventListener("close",(()=>i())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(Dt,Nt,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(kt)}catch(t){console.warn(t)}}}).catch((t=>{throw St.create("idb-open",{originalErrorMessage:t.message})}))),xt}async function Lt(t,e){try{const n=(await Rt()).transaction(kt,"readwrite"),r=n.objectStore(kt);await r.put(e,Ot(t)),await n.done}catch(t){if(t instanceof u)H.warn(t.message);else{const e=St.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});H.warn(e.message)}}}function Ot(t){return`${t.name}!${t.options.appId}`}class Mt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Vt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Pt();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Pt(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),Ft(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Ft(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=s(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Pt(){return(new Date).toISOString().substring(0,10)}class Vt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!h()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await Rt();return await e.transaction(kt).objectStore(kt).get(Ot(t))}catch(t){if(t instanceof u)H.warn(t.message);else{const e=St.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});H.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Lt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Lt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Ft(t){return s(JSON.stringify({version:2,heartbeats:t})).length}Tt(new m("platform-logger",(t=>new z(t)),"PRIVATE")),Tt(new m("heartbeat",(t=>new Mt(t)),"PRIVATE")),At(K,G,""),At(K,G,"esm2017"),At("fire-js",""),At("firebase","10.7.2","app");var Ut,Bt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},jt={},qt=qt||{},$t=Bt||self;function zt(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Kt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Gt="closure_uid_"+(1e9*Math.random()>>>0),Ht=0;function Qt(t,e,n){return t.call.apply(t.bind,arguments)}function Wt(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Xt(t,e,n){return(Xt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Qt:Wt).apply(null,arguments)}function Yt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Jt(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function Zt(){this.s=this.s,this.o=this.o}Zt.prototype.s=!1,Zt.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,Gt)&&t[Gt]||(t[Gt]=++Ht))},Zt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const te=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function ee(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function ne(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(zt(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let s=0;s<r;s++)t[e+s]=n[s]}else t.push(n)}}function re(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}re.prototype.h=function(){this.defaultPrevented=!0};var se=function(){if(!$t.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};$t.addEventListener("test",t,e),$t.removeEventListener("test",t,e)}catch(t){}return t}();function ie(t){return/^[\s\xa0]*$/.test(t)}function oe(){var t=$t.navigator;return t&&(t=t.userAgent)?t:""}function ae(t){return-1!=oe().indexOf(t)}function ce(t){return ce[" "](t),t}ce[" "]=function(){};var he,ue,le,de=ae("Opera"),fe=ae("Trident")||ae("MSIE"),pe=ae("Edge"),ge=pe||fe,me=ae("Gecko")&&!(-1!=oe().toLowerCase().indexOf("webkit")&&!ae("Edge"))&&!(ae("Trident")||ae("MSIE"))&&!ae("Edge"),ye=-1!=oe().toLowerCase().indexOf("webkit")&&!ae("Edge");function ve(){var t=$t.document;return t?t.documentMode:void 0}t:{var we="",Ee=(ue=oe(),me?/rv:([^\);]+)(\)|;)/.exec(ue):pe?/Edge\/([\d\.]+)/.exec(ue):fe?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ue):ye?/WebKit\/(\S+)/.exec(ue):de?/(?:Version)[ \/]?(\S+)/.exec(ue):void 0);if(Ee&&(we=Ee?Ee[1]:""),fe){var be=ve();if(null!=be&&be>parseFloat(we)){he=String(be);break t}}he=we}$t.document&&fe?le=ve()||parseInt(he,10)||void 0:le=void 0;var _e=le;function Te(t,e){if(re.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(me){t:{try{ce(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Se[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Te.$.h.call(this)}}Jt(Te,re);var Se={2:"touch",3:"pen",4:"mouse"};Te.prototype.h=function(){Te.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Ie="closure_listenable_"+(1e6*Math.random()|0),Ce=0;function Ae(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=s,this.key=++Ce,this.fa=this.ia=!1}function De(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Ne(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function ke(t){const e={};for(const n in t)e[n]=t[n];return e}const xe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Re(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<xe.length;e++)n=xe[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Le(t){this.src=t,this.g={},this.h=0}function Oe(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=te(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(De(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Me(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.fa&&i.listener==e&&i.capture==!!n&&i.la==r)return s}return-1}Le.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=Me(t,e,r,s);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new Ae(e,this.src,i,!!r,s)).ia=n,t.push(e)),e};var Pe="closure_lm_"+(1e6*Math.random()|0),Ve={};function Fe(t,e,n,r,s){if(r&&r.once)return Be(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Fe(t,e[i],n,r,s);return null}return n=He(n),t&&t[Ie]?t.O(e,n,Kt(r)?!!r.capture:!!r,s):Ue(t,e,n,!1,r,s)}function Ue(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=Kt(s)?!!s.capture:!!s,a=Ke(t);if(a||(t[Pe]=a=new Le(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){const t=ze;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)se||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent($e(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Be(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Be(t,e[i],n,r,s);return null}return n=He(n),t&&t[Ie]?t.P(e,n,Kt(r)?!!r.capture:!!r,s):Ue(t,e,n,!0,r,s)}function je(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)je(t,e[i],n,r,s);else r=Kt(r)?!!r.capture:!!r,n=He(n),t&&t[Ie]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Me(i=t.g[e],n,r,s))&&(De(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=Ke(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Me(e,n,r,s)),(n=-1<t?e[t]:null)&&qe(n))}function qe(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[Ie])Oe(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent($e(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ke(e))?(Oe(n,t),0==n.h&&(n.src=null,e[Pe]=null)):De(t)}}}function $e(t){return t in Ve?Ve[t]:Ve[t]="on"+t}function ze(t,e){if(t.fa)t=!0;else{e=new Te(e,this);var n=t.listener,r=t.la||t.src;t.ia&&qe(t),t=n.call(r,e)}return t}function Ke(t){return(t=t[Pe])instanceof Le?t:null}var Ge="__closure_events_fn_"+(1e9*Math.random()>>>0);function He(t){return"function"==typeof t?t:(t[Ge]||(t[Ge]=function(e){return t.handleEvent(e)}),t[Ge])}function Qe(){Zt.call(this),this.i=new Le(this),this.S=this,this.J=null}function We(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new re(e,t);else if(e instanceof re)e.target=e.target||t;else{var s=e;Re(e=new re(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=Xe(o,r,!0,e)&&s}if(s=Xe(o=e.g=t,r,!0,e)&&s,s=Xe(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Xe(o=e.g=n[i],r,!1,e)&&s}function Xe(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Oe(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}Jt(Qe,Zt),Qe.prototype[Ie]=!0,Qe.prototype.removeEventListener=function(t,e,n,r){je(this,t,e,n,r)},Qe.prototype.N=function(){if(Qe.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)De(n[r]);delete e.g[t],e.h--}}this.J=null},Qe.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Qe.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Ye=$t.JSON.stringify;function Je(){var t=on;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ze=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new tn),(t=>t.reset()));class tn{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function en(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function nn(t){$t.setTimeout((()=>{throw t}),0)}let rn,sn=!1,on=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ze.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},an=()=>{const t=$t.Promise.resolve(void 0);rn=()=>{t.then(cn)}};var cn=()=>{for(var t;t=Je();){try{t.h.call(t.g)}catch(t){nn(t)}var e=Ze;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}sn=!1};function hn(t,e){Qe.call(this),this.h=t||1,this.g=e||$t,this.j=Xt(this.qb,this),this.l=Date.now()}function un(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function ln(t,e,n){if("function"==typeof t)n&&(t=Xt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Xt(t.handleEvent,t)}return 2147483647<Number(e)?-1:$t.setTimeout(t,e||0)}function dn(t){t.g=ln((()=>{t.g=null,t.i&&(t.i=!1,dn(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Jt(hn,Qe),(Ut=hn.prototype).ga=!1,Ut.T=null,Ut.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),We(this,"tick"),this.ga&&(un(this),this.start()))}},Ut.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Ut.N=function(){hn.$.N.call(this),un(this),delete this.g};class fn extends Zt{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:dn(this)}N(){super.N(),this.g&&($t.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function pn(t){Zt.call(this),this.h=t,this.g={}}Jt(pn,Zt);var gn=[];function mn(t,e,n,r){Array.isArray(n)||(n&&(gn[0]=n.toString()),n=gn);for(var s=0;s<n.length;s++){var i=Fe(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function yn(t){Ne(t.g,(function(t,e){this.g.hasOwnProperty(e)&&qe(t)}),t),t.g={}}function vn(){this.g=!0}function wn(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ye(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}pn.prototype.N=function(){pn.$.N.call(this),yn(this)},pn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},vn.prototype.Ea=function(){this.g=!1},vn.prototype.info=function(){};var En={},bn=null;function _n(){return bn=bn||new Qe}function Tn(t){re.call(this,En.Ta,t)}function Sn(t){const e=_n();We(e,new Tn(e))}function In(t,e){re.call(this,En.STAT_EVENT,t),this.stat=e}function Cn(t){const e=_n();We(e,new In(e,t))}function An(t,e){re.call(this,En.Ua,t),this.size=e}function Dn(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return $t.setTimeout((function(){t()}),e)}En.Ta="serverreachability",Jt(Tn,re),En.STAT_EVENT="statevent",Jt(In,re),En.Ua="timingevent",Jt(An,re);var Nn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},kn={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function xn(){}function Rn(t){return t.h||(t.h=t.i())}function Ln(){}xn.prototype.h=null;var On,Mn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Pn(){re.call(this,"d")}function Vn(){re.call(this,"c")}function Fn(){}function Un(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new pn(this),this.P=jn,t=ge?125:void 0,this.V=new hn(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Bn}function Bn(){this.i=null,this.g="",this.h=!1}Jt(Pn,re),Jt(Vn,re),Jt(Fn,xn),Fn.prototype.g=function(){return new XMLHttpRequest},Fn.prototype.i=function(){return{}},On=new Fn;var jn=45e3,qn={},$n={};function zn(t,e,n){t.L=1,t.A=hr(sr(e)),t.u=n,t.S=!0,Kn(t,null)}function Kn(t,e){t.G=Date.now(),Wn(t),t.B=sr(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),_r(n.i,"t",r),t.o=0,n=t.l.J,t.h=new Bn,t.g=_s(t.l,n?e:null,!t.u),0<t.O&&(t.M=new fn(Xt(t.Pa,t,t.g),t.O)),mn(t.U,t.g,"readystatechange",t.nb),e=t.I?ke(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),Sn(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var h=a[c].split("=");if(1<h.length){var u=h[0];h=h[1];var l=u.split("_");o=2<=l.length&&"type"==l[1]?o+(u+"=")+h+"&":o+(u+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function Gn(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function Hn(t,e,n){let r,s=!0;for(;!t.J&&t.o<n.length;){if(r=Qn(t,n),r==$n){4==e&&(t.s=4,Cn(14),s=!1),wn(t.j,t.m,null,"[Incomplete Response]");break}if(r==qn){t.s=4,Cn(15),wn(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}wn(t.j,t.m,r,null),tr(t,r)}Gn(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,Cn(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),ps(e),e.M=!0,Cn(11))):(wn(t.j,t.m,n,"[Invalid Chunked Response]"),Zn(t),Jn(t))}function Qn(t,e){var n=t.o,r=e.indexOf("\n",n);return-1==r?$n:(n=Number(e.substring(n,r)),isNaN(n)?qn:(r+=1)+n>e.length?$n:(e=e.slice(r,r+n),t.o=r+n,e))}function Wn(t){t.Y=Date.now()+t.P,Xn(t,t.P)}function Xn(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=Dn(Xt(t.lb,t),e)}function Yn(t){t.C&&($t.clearTimeout(t.C),t.C=null)}function Jn(t){0==t.l.H||t.J||ys(t.l,t)}function Zn(t){Yn(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,un(t.V),yn(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function tr(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Nr(n.i,t)))if(!t.K&&Nr(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;ms(n),os(n)}fs(n),Cn(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=Dn(Xt(n.ib,n),6e3));if(1>=Dr(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else ws(n,11)}else if((t.K||n.g==t)&&ms(n),!ie(e))for(s=n.Ja.g.parse(e),e=0;e<s.length;e++){let h=s[e];if(n.V=h[0],h=h[1],2==n.H)if("c"==h[0]){n.K=h[1],n.pa=h[2];const e=h[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const s=h[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const u=h[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.i;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(kr(i,i.h),i.h=null))}if(r.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,cr(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=bs(r,r.J?r.pa:null,r.Y),o.K){xr(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(Yn(a),Wn(a)),r.g=o}else ds(r);0<n.j.length&&cs(n)}else"stop"!=h[0]&&"close"!=h[0]||ws(n,7);else 3==n.H&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?ws(n,7):is(n):"noop"!=h[0]&&n.h&&n.h.Aa(h),n.A=0)}Sn()}catch(t){}}function er(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(zt(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(zt(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(zt(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}(Ut=Un.prototype).setTimeout=function(t){this.P=t},Ut.nb=function(t){t=t.target;const e=this.M;e&&3==Zr(t)?e.l():this.Pa(t)},Ut.Pa=function(t){try{if(t==this.g)t:{const u=Zr(this.g);var e=this.g.Ia();if(this.g.da(),!(3>u)&&(3!=u||ge||this.g&&(this.h.h||this.g.ja()||ts(this.g)))){this.J||4!=u||7==e||Sn(),Yn(this);var n=this.g.da();this.ca=n;e:if(Gn(this)){var r=ts(this.g);t="";var s=r.length,i=4==Zr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Zn(this),Jn(this);var o="";break e}this.h.i=new $t.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.v,this.B,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ie(a)){var h=a;break e}}h=null}if(!(n=h)){this.i=!1,this.s=3,Cn(12),Zn(this),Jn(this);break t}wn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,tr(this,n)}this.S?(Hn(this,u,o),ge&&this.i&&3==u&&(mn(this.U,this.V,"tick",this.mb),this.V.start())):(wn(this.j,this.m,o,null),tr(this,o)),4==u&&Zn(this),this.i&&!this.J&&(4==u?ys(this.l,this):(this.i=!1,Wn(this)))}else(function(t){const e={};t=(t.g&&2<=Zr(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(ie(t[r]))continue;var n=en(t[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=e[s]||[];e[s]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Cn(12)):(this.s=0,Cn(13)),Zn(this),Jn(this)}}}catch(t){}},Ut.mb=function(){if(this.g){var t=Zr(this.g),e=this.g.ja();this.o<e.length&&(Yn(this),Hn(this,t,e),this.i&&4!=t&&Wn(this))}},Ut.cancel=function(){this.J=!0,Zn(this)},Ut.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(Sn(),Cn(17)),Zn(this),this.s=2,Jn(this)):Xn(this,this.Y-t)};var nr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rr(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof rr){this.h=t.h,ir(this,t.j),this.s=t.s,this.g=t.g,or(this,t.m),this.l=t.l;var e=t.i,n=new vr;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),ar(this,n),this.o=t.o}else t&&(e=String(t).match(nr))?(this.h=!1,ir(this,e[1]||"",!0),this.s=ur(e[2]||""),this.g=ur(e[3]||"",!0),or(this,e[4]),this.l=ur(e[5]||"",!0),ar(this,e[6]||"",!0),this.o=ur(e[7]||"")):(this.h=!1,this.i=new vr(null,this.h))}function sr(t){return new rr(t)}function ir(t,e,n){t.j=n?ur(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function or(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function ar(t,e,n){e instanceof vr?(t.i=e,function(t,e){e&&!t.j&&(wr(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Er(this,e),_r(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=lr(e,mr)),t.i=new vr(e,t.h))}function cr(t,e,n){t.i.set(e,n)}function hr(t){return cr(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function ur(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function lr(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,dr),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function dr(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}rr.prototype.toString=function(){var t=[],e=this.j;e&&t.push(lr(e,fr,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(lr(e,fr,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(lr(n,"/"==n.charAt(0)?gr:pr,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",lr(n,yr)),t.join("")};var fr=/[#\/\?@]/g,pr=/[#\?:]/g,gr=/[#\?]/g,mr=/[#\?@]/g,yr=/#/g;function vr(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function wr(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Er(t,e){wr(t),e=Tr(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function br(t,e){return wr(t),e=Tr(t,e),t.g.has(e)}function _r(t,e,n){Er(t,e),0<n.length&&(t.i=null,t.g.set(Tr(t,e),ee(n)),t.h+=n.length)}function Tr(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(Ut=vr.prototype).add=function(t,e){wr(this),this.i=null,t=Tr(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},Ut.forEach=function(t,e){wr(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},Ut.ta=function(){wr(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let t=0;t<s.length;t++)n.push(e[r])}return n},Ut.Z=function(t){wr(this);let e=[];if("string"==typeof t)br(this,t)&&(e=e.concat(this.g.get(Tr(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},Ut.set=function(t,e){return wr(this),this.i=null,br(this,t=Tr(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},Ut.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},Ut.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),t.push(s)}}return this.i=t.join("&")};var Sr=class{constructor(t,e){this.g=t,this.map=e}};function Ir(t){this.l=t||Cr,t=$t.PerformanceNavigationTiming?0<(t=$t.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!($t.g&&$t.g.Ka&&$t.g.Ka()&&$t.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Cr=10;function Ar(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Dr(t){return t.h?1:t.g?t.g.size:0}function Nr(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function kr(t,e){t.g?t.g.add(e):t.h=e}function xr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Rr(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return ee(t.i)}Ir.prototype.cancel=function(){if(this.i=Rr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var Lr=class{stringify(t){return $t.JSON.stringify(t,void 0)}parse(t){return $t.JSON.parse(t,void 0)}};function Or(){this.g=new Lr}function Mr(t,e,n){const r=n||"";try{er(t,(function(t,n){let s=t;Kt(t)&&(s=Ye(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Pr(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}function Vr(t){this.l=t.ec||null,this.j=t.ob||!1}function Fr(t,e){Qe.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=Ur,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Jt(Vr,xn),Vr.prototype.g=function(){return new Fr(this.l,this.j)},Vr.prototype.i=function(t){return function(){return t}}({}),Jt(Fr,Qe);var Ur=0;function Br(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function jr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,qr(t)}function qr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(Ut=Fr.prototype).open=function(t,e){if(this.readyState!=Ur)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,qr(this)},Ut.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||$t).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},Ut.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jr(this)),this.readyState=Ur},Ut.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,qr(this)),this.g&&(this.readyState=3,qr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==$t.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Br(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},Ut.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?jr(this):qr(this),3==this.readyState&&Br(this)}},Ut.Za=function(t){this.g&&(this.response=this.responseText=t,jr(this))},Ut.Ya=function(t){this.g&&(this.response=t,jr(this))},Ut.ka=function(){this.g&&jr(this)},Ut.setRequestHeader=function(t,e){this.v.append(t,e)},Ut.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},Ut.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Fr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var $r=$t.JSON.parse;function zr(t){Qe.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Kr,this.L=this.M=!1}Jt(zr,Qe);var Kr="",Gr=/^https?$/i,Hr=["POST","PUT"];function Qr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Wr(t),Yr(t)}function Wr(t){t.F||(t.F=!0,We(t,"complete"),We(t,"error"))}function Xr(t){if(t.h&&void 0!==qt&&(!t.C[1]||4!=Zr(t)||2!=t.da()))if(t.v&&4==Zr(t))ln(t.La,0,t);else if(We(t,"readystatechange"),4==Zr(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var s=String(t.I).match(nr)[1]||null;!s&&$t.self&&$t.self.location&&(s=$t.self.location.protocol.slice(0,-1)),r=!Gr.test(s?s.toLowerCase():"")}n=r}if(n)We(t,"complete"),We(t,"success");else{t.m=6;try{var i=2<Zr(t)?t.g.statusText:""}catch(t){i=""}t.j=i+" ["+t.da()+"]",Wr(t)}}finally{Yr(t)}}}function Yr(t,e){if(t.g){Jr(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||We(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Jr(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&($t.clearTimeout(t.A),t.A=null)}function Zr(t){return t.g?t.g.readyState:0}function ts(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Kr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function es(t){let e="";return Ne(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function ns(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=es(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):cr(t,e,n))}function rs(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function ss(t){this.Ga=0,this.j=[],this.l=new vn,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=rs("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=rs("baseRetryDelayMs",5e3,t),this.hb=rs("retryDelaySeedMs",1e4,t),this.eb=rs("forwardChannelMaxRetries",2,t),this.xa=rs("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Ir(t&&t.concurrentRequestLimit),this.Ja=new Or,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function is(t){if(as(t),3==t.H){var e=t.W++,n=sr(t.I);if(cr(n,"SID",t.K),cr(n,"RID",e),cr(n,"TYPE","terminate"),us(t,n),(e=new Un(t,t.l,e)).L=2,e.A=hr(sr(n)),n=!1,$t.navigator&&$t.navigator.sendBeacon)try{n=$t.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&$t.Image&&((new Image).src=e.A,n=!0),n||(e.g=_s(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Wn(e)}Es(t)}function os(t){t.g&&(ps(t),t.g.cancel(),t.g=null)}function as(t){os(t),t.u&&($t.clearTimeout(t.u),t.u=null),ms(t),t.i.cancel(),t.m&&("number"==typeof t.m&&$t.clearTimeout(t.m),t.m=null)}function cs(t){if(!Ar(t.i)&&!t.m){t.m=!0;var e=t.Na;rn||an(),sn||(rn(),sn=!0),on.add(e,t),t.C=0}}function hs(t,e){var n;n=e?e.m:t.W++;const r=sr(t.I);cr(r,"SID",t.K),cr(r,"RID",n),cr(r,"AID",t.V),us(t,r),t.o&&t.s&&ns(r,t.o,t.s),n=new Un(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=ls(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),kr(t.i,n),zn(n,r,e)}function us(t,e){t.na&&Ne(t.na,(function(t,n){cr(e,n,t)})),t.h&&er({},(function(t,n){cr(e,n,t)}))}function ls(t,e,n){n=Math.min(t.j.length,n);var r=t.h?Xt(t.h.Va,t.h,t):null;t:{var s=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=e,0>n)e=Math.max(0,s[o].g-100),i=!1;else try{Mr(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(i){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function ds(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;rn||an(),sn||(rn(),sn=!0),on.add(e,t),t.A=0}}function fs(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=Dn(Xt(t.Ma,t),vs(t,t.A)),t.A++,0))}function ps(t){null!=t.B&&($t.clearTimeout(t.B),t.B=null)}function gs(t){t.g=new Un(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=sr(t.wa);cr(e,"RID","rpc"),cr(e,"SID",t.K),cr(e,"AID",t.V),cr(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&cr(e,"TO",t.qa),cr(e,"TYPE","xmlhttp"),us(t,e),t.o&&t.s&&ns(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=hr(sr(e)),n.u=null,n.S=!0,Kn(n,t)}function ms(t){null!=t.v&&($t.clearTimeout(t.v),t.v=null)}function ys(t,e){var n=null;if(t.g==e){ms(t),ps(t),t.g=null;var r=2}else{if(!Nr(t.i,e))return;n=e.F,xr(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.G;var s=t.C;We(r=_n(),new An(r,n)),cs(t)}else ds(t);else if(3==(s=e.s)||0==s&&0<e.ca||!(1==r&&function(t,e){return!(Dr(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=Dn(Xt(t.Na,t,e),vs(t,t.C)),t.C++,0)))}(t,e)||2==r&&fs(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:ws(t,5);break;case 4:ws(t,10);break;case 3:ws(t,6);break;default:ws(t,2)}}function vs(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function ws(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=Xt(t.pb,t);n||(n=new rr("//www.google.com/images/cleardot.gif"),$t.location&&"http"==$t.location.protocol||ir(n,"https"),hr(n)),function(t,e){const n=new vn;if($t.Image){const r=new Image;r.onload=Yt(Pr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Yt(Pr,n,r,"TestLoadImage: error",!1,e),r.onabort=Yt(Pr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Yt(Pr,n,r,"TestLoadImage: timeout",!1,e),$t.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Cn(2);t.H=0,t.h&&t.h.za(e),Es(t),as(t)}function Es(t){if(t.H=0,t.ma=[],t.h){const e=Rr(t.i);0==e.length&&0==t.j.length||(ne(t.ma,e),ne(t.ma,t.j),t.i.i.length=0,ee(t.j),t.j.length=0),t.h.ya()}}function bs(t,e,n){var r=n instanceof rr?sr(n):new rr(n);if(""!=r.g)e&&(r.g=e+"."+r.g),or(r,r.m);else{var s=$t.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new rr(null);r&&ir(i,r),e&&(i.g=e),s&&or(i,s),n&&(i.l=n),r=i}return n=t.F,e=t.Da,n&&e&&cr(r,n,e),cr(r,"VER",t.ra),us(t,r),r}function _s(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new zr(new Vr({ob:n})):new zr(t.va)).Oa(t.J),e}function Ts(){}function Ss(){if(fe&&!(10<=Number(_e)))throw Error("Environmental error: no available transport.")}function Is(t,e){Qe.call(this),this.g=new ss(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!ie(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!ie(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Ds(this)}function Cs(t){Pn.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function As(){Vn.call(this),this.status=1}function Ds(t){this.g=t}function Ns(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ks(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var i=t.g[3],o=e+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=n+(o<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=n+((o=e+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(e^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+i&4294967295}function xs(t,e){this.h=e;for(var n=[],r=!0,s=t.length-1;0<=s;s--){var i=0|t[s];r&&i==e||(n[s]=i,r=!1)}this.g=n}(Ut=zr.prototype).Oa=function(t){this.M=t},Ut.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():On.g(),this.C=this.u?Rn(this.u):Rn(On),this.g.onreadystatechange=Xt(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Qr(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=$t.FormData&&t instanceof $t.FormData,!(0<=te(Hr,e))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Jr(this),0<this.B&&((this.L=function(t){return fe&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Xt(this.ua,this)):this.A=ln(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Qr(this,t)}},Ut.ua=function(){void 0!==qt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,We(this,"timeout"),this.abort(8))},Ut.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,We(this,"complete"),We(this,"abort"),Yr(this))},Ut.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Yr(this,!0)),zr.$.N.call(this)},Ut.La=function(){this.s||(this.G||this.v||this.l?Xr(this):this.kb())},Ut.kb=function(){Xr(this)},Ut.isActive=function(){return!!this.g},Ut.da=function(){try{return 2<Zr(this)?this.g.status:-1}catch(t){return-1}},Ut.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},Ut.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),$r(e)}},Ut.Ia=function(){return this.m},Ut.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Ut=ss.prototype).ra=8,Ut.H=1,Ut.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new Un(this,this.l,t);let i=this.s;if(this.U&&(i?(i=ke(i),Re(i,this.U)):i=this.U),null!==this.o||this.O||(s.I=i,i=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=ls(this,s,e),cr(n=sr(this.I),"RID",t),cr(n,"CVER",22),this.F&&cr(n,"X-HTTP-Session-Id",this.F),us(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(es(i)))+"&"+e:this.o&&ns(n,this.o,i)),kr(this.i,s),this.bb&&cr(n,"TYPE","init"),this.P?(cr(n,"$req",e),cr(n,"SID","null"),s.aa=!0,zn(s,n,null)):zn(s,n,e),this.H=2}}else 3==this.H&&(t?hs(this,t):0==this.j.length||Ar(this.i)||hs(this))},Ut.Ma=function(){if(this.u=null,gs(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Dn(Xt(this.jb,this),t)}},Ut.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Cn(10),os(this),gs(this))},Ut.ib=function(){null!=this.v&&(this.v=null,os(this),fs(this),Cn(19))},Ut.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Cn(2)):(this.l.info("Failed to ping google.com"),Cn(1))},Ut.isActive=function(){return!!this.h&&this.h.isActive(this)},(Ut=Ts.prototype).Ba=function(){},Ut.Aa=function(){},Ut.za=function(){},Ut.ya=function(){},Ut.isActive=function(){return!0},Ut.Va=function(){},Ss.prototype.g=function(t,e){return new Is(t,e)},Jt(Is,Qe),Is.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Cn(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=bs(t,null,t.Y),cs(t)},Is.prototype.close=function(){is(this.g)},Is.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=Ye(t),t=n);e.j.push(new Sr(e.fb++,t)),3==e.H&&cs(e)},Is.prototype.N=function(){this.g.h=null,delete this.j,is(this.g),delete this.g,Is.$.N.call(this)},Jt(Cs,Pn),Jt(As,Vn),Jt(Ds,Ts),Ds.prototype.Ba=function(){We(this.g,"a")},Ds.prototype.Aa=function(t){We(this.g,new Cs(t))},Ds.prototype.za=function(t){We(this.g,new As)},Ds.prototype.ya=function(){We(this.g,"b")},Jt(Ns,(function(){this.blockSize=-1})),Ns.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ns.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,s=this.h,i=0;i<e;){if(0==s)for(;i<=n;)ks(this,t,i),i+=this.blockSize;if("string"==typeof t){for(;i<e;)if(r[s++]=t.charCodeAt(i++),s==this.blockSize){ks(this,r),s=0;break}}else for(;i<e;)if(r[s++]=t[i++],s==this.blockSize){ks(this,r),s=0;break}}this.h=s,this.i+=e},Ns.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var Rs={};function Ls(t){return-128<=t&&128>t?function(t,e){var n=Rs;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new xs([0|t],0>t?-1:0)}(t)}(t):new xs([0|t],0>t?-1:0)}function Os(t){if(isNaN(t)||!isFinite(t))return Ps;if(0>t)return js(Os(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=Ms;return new xs(e,0)}var Ms=4294967296,Ps=Ls(0),Vs=Ls(1),Fs=Ls(16777216);function Us(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function Bs(t){return-1==t.h}function js(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new xs(n,~t.h).add(Vs)}function qs(t,e){return t.add(js(e))}function $s(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function zs(t,e){this.g=t,this.h=e}function Ks(t,e){if(Us(e))throw Error("division by zero");if(Us(t))return new zs(Ps,Ps);if(Bs(t))return e=Ks(js(t),e),new zs(js(e.g),js(e.h));if(Bs(e))return e=Ks(t,js(e)),new zs(js(e.g),e.h);if(30<t.g.length){if(Bs(t)||Bs(e))throw Error("slowDivide_ only works with positive integers.");for(var n=Vs,r=e;0>=r.X(t);)n=Gs(n),r=Gs(r);var s=Hs(n,1),i=Hs(r,1);for(r=Hs(r,2),n=Hs(n,2);!Us(r);){var o=i.add(r);0>=o.X(t)&&(s=s.add(n),i=o),r=Hs(r,1),n=Hs(n,1)}return e=qs(t,s.R(e)),new zs(s,e)}for(s=Ps;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(i=Os(n)).R(e);Bs(o)||0<o.X(t);)o=(i=Os(n-=r)).R(e);Us(i)&&(i=Vs),s=s.add(i),t=qs(t,o)}return new zs(s,t)}function Gs(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new xs(n,t.h)}function Hs(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,s=[],i=0;i<r;i++)s[i]=0<e?t.D(i+n)>>>e|t.D(i+n+1)<<32-e:t.D(i+n);return new xs(s,t.h)}(Ut=xs.prototype).ea=function(){if(Bs(this))return-js(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:Ms+r)*e,e*=Ms}return t},Ut.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(Us(this))return"0";if(Bs(this))return"-"+js(this).toString(t);for(var e=Os(Math.pow(t,6)),n=this,r="";;){var s=Ks(n,e).g,i=((0<(n=qs(n,s.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(Us(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},Ut.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},Ut.X=function(t){return Bs(t=qs(this,t))?-1:Us(t)?0:1},Ut.abs=function(){return Bs(this)?js(this):this},Ut.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,s=0;s<=e;s++){var i=r+(65535&this.D(s))+(65535&t.D(s)),o=(i>>>16)+(this.D(s)>>>16)+(t.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,n[s]=o<<16|i}return new xs(n,-2147483648&n[n.length-1]?-1:0)},Ut.R=function(t){if(Us(this)||Us(t))return Ps;if(Bs(this))return Bs(t)?js(this).R(js(t)):js(js(this).R(t));if(Bs(t))return js(this.R(js(t)));if(0>this.X(Fs)&&0>t.X(Fs))return Os(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<t.g.length;s++){var i=this.D(r)>>>16,o=65535&this.D(r),a=t.D(s)>>>16,c=65535&t.D(s);n[2*r+2*s]+=o*c,$s(n,2*r+2*s),n[2*r+2*s+1]+=i*c,$s(n,2*r+2*s+1),n[2*r+2*s+1]+=o*a,$s(n,2*r+2*s+1),n[2*r+2*s+2]+=i*a,$s(n,2*r+2*s+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new xs(n,0)},Ut.gb=function(t){return Ks(this,t).h},Ut.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new xs(n,this.h&t.h)},Ut.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new xs(n,this.h|t.h)},Ut.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new xs(n,this.h^t.h)},Ss.prototype.createWebChannel=Ss.prototype.g,Is.prototype.send=Is.prototype.u,Is.prototype.open=Is.prototype.m,Is.prototype.close=Is.prototype.close,Nn.NO_ERROR=0,Nn.TIMEOUT=8,Nn.HTTP_ERROR=6,kn.COMPLETE="complete",Ln.EventType=Mn,Mn.OPEN="a",Mn.CLOSE="b",Mn.ERROR="c",Mn.MESSAGE="d",Qe.prototype.listen=Qe.prototype.O,zr.prototype.listenOnce=zr.prototype.P,zr.prototype.getLastError=zr.prototype.Sa,zr.prototype.getLastErrorCode=zr.prototype.Ia,zr.prototype.getStatus=zr.prototype.da,zr.prototype.getResponseJson=zr.prototype.Wa,zr.prototype.getResponseText=zr.prototype.ja,zr.prototype.send=zr.prototype.ha,zr.prototype.setWithCredentials=zr.prototype.Oa,Ns.prototype.digest=Ns.prototype.l,Ns.prototype.reset=Ns.prototype.reset,Ns.prototype.update=Ns.prototype.j,xs.prototype.add=xs.prototype.add,xs.prototype.multiply=xs.prototype.R,xs.prototype.modulo=xs.prototype.gb,xs.prototype.compare=xs.prototype.X,xs.prototype.toNumber=xs.prototype.ea,xs.prototype.toString=xs.prototype.toString,xs.prototype.getBits=xs.prototype.D,xs.fromNumber=Os,xs.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return js(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=Os(Math.pow(n,8)),s=Ps,i=0;i<e.length;i+=8){var o=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+o),n);8>o?(o=Os(Math.pow(n,o)),s=s.R(o).add(Os(a))):s=(s=s.R(r)).add(Os(a))}return s};var Qs=jt.createWebChannelTransport=function(){return new Ss},Ws=jt.getStatEventTarget=function(){return _n()},Xs=jt.ErrorCode=Nn,Ys=jt.EventType=kn,Js=jt.Event=En,Zs=jt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},ti=(jt.FetchXmlHttpFactory=Vr,jt.WebChannel=Ln),ei=jt.XhrIo=zr,ni=jt.Md5=Ns,ri=jt.Integer=xs;const si="@firebase/firestore";class ii{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}ii.UNAUTHENTICATED=new ii(null),ii.GOOGLE_CREDENTIALS=new ii("google-credentials-uid"),ii.FIRST_PARTY=new ii("first-party-uid"),ii.MOCK_USER=new ii("mock-user");let oi="10.7.2";const ai=new C("@firebase/firestore");function ci(){return ai.logLevel}function hi(t,...e){if(ai.logLevel<=b.DEBUG){const n=e.map(di);ai.debug(`Firestore (${oi}): ${t}`,...n)}}function ui(t,...e){if(ai.logLevel<=b.ERROR){const n=e.map(di);ai.error(`Firestore (${oi}): ${t}`,...n)}}function li(t,...e){if(ai.logLevel<=b.WARN){const n=e.map(di);ai.warn(`Firestore (${oi}): ${t}`,...n)}}function di(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function fi(t="Unexpected state"){const e=`FIRESTORE (${oi}) INTERNAL ASSERTION FAILED: `+t;throw ui(e),new Error(e)}function pi(t,e){t||fi()}function gi(t,e){return t}const mi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class yi extends u{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class vi{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class wi{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Ei{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(ii.UNAUTHENTICATED)))}shutdown(){}}class bi{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class _i{constructor(t){this.t=t,this.currentUser=ii.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new vi;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new vi,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{hi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(hi("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new vi)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(hi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(pi("string"==typeof e.accessToken),new wi(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return pi(null===t||"string"==typeof t),new ii(t)}}class Ti{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=ii.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Si{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Ti(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(ii.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ii{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ci{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&hi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,hi("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{hi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):hi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(pi("string"==typeof t.token),this.R=t.token,new Ii(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ai(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Di{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Ai(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function Ni(t,e){return t<e?-1:t>e?1:0}function ki(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class xi{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new yi(mi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new yi(mi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new yi(mi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new yi(mi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return xi.fromMillis(Date.now())}static fromDate(t){return xi.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new xi(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Ni(this.nanoseconds,t.nanoseconds):Ni(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ri{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Ri(t)}static min(){return new Ri(new xi(0,0))}static max(){return new Ri(new xi(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Li{constructor(t,e,n){void 0===e?e=0:e>t.length&&fi(),void 0===n?n=t.length-e:n>t.length-e&&fi(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Li.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Li?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Oi extends Li{construct(t,e,n){return new Oi(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new yi(mi.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Oi(e)}static emptyPath(){return new Oi([])}}const Mi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Pi extends Li{construct(t,e,n){return new Pi(t,e,n)}static isValidIdentifier(t){return Mi.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Pi.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Pi(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new yi(mi.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new yi(mi.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new yi(mi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new yi(mi.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Pi(e)}static emptyPath(){return new Pi([])}}class Vi{constructor(t){this.path=t}static fromPath(t){return new Vi(Oi.fromString(t))}static fromName(t){return new Vi(Oi.fromString(t).popFirst(5))}static empty(){return new Vi(Oi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Oi.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Oi.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Vi(new Oi(t.slice()))}}function Fi(t){return new Ui(t.readTime,t.key,-1)}class Ui{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Ui(Ri.min(),Vi.empty(),-1)}static max(){return new Ui(Ri.max(),Vi.empty(),-1)}}function Bi(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=Vi.comparator(t.documentKey,e.documentKey),0!==n?n:Ni(t.largestBatchId,e.largestBatchId))}const ji="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class qi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function $i(t){if(t.code!==mi.FAILED_PRECONDITION||t.message!==ji)throw t;hi("LocalStore","Unexpectedly lost primary lease")}class zi{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&fi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new zi(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof zi?e:zi.resolve(e)}catch(t){return zi.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):zi.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):zi.reject(e)}static resolve(t){return new zi(((e,n)=>{e(t)}))}static reject(t){return new zi(((e,n)=>{n(t)}))}static waitFor(t){return new zi(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=zi.resolve(!1);for(const n of t)e=e.next((t=>t?zi.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new zi(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{i[c]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new zi(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}class Ki{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new vi,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Qi(t,e.error)):this.V.resolve()},this.transaction.onerror=e=>{const n=Zi(e.target.error);this.V.reject(new Qi(t,n))}}static open(t,e,n,r){try{return new Ki(e,t.transaction(r,n))}catch(t){throw new Qi(e,t)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(hi("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Xi(e)}}class Gi{constructor(t,e,n){this.name=t,this.version=e,this.p=n,12.2===Gi.S(c())&&ui("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return hi("SimpleDb","Removing database:",t),Yi(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!h())return!1;if(Gi.C())return!0;const t=c(),e=Gi.S(t),n=0<e&&e<10,r=Gi.v(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static C(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(t){return this.db||(hi("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Qi(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new yi(mi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new yi(mi.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Qi(t,r))},r.onupgradeneeded=t=>{hi("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.p.N(e,r.transaction,t.oldVersion,this.version).next((()=>{hi("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.O(t);const e=Ki.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).next((t=>(e.g(),t))).catch((t=>(e.abort(t),zi.reject(t)))).toPromise();return i.catch((()=>{})),await e.m,i}catch(t){const e=t,n="FirebaseError"!==e.name&&i<3;if(hi("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Hi{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return Yi(this.k.delete())}}class Qi extends yi{constructor(t,e){super(mi.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Wi(t){return"IndexedDbTransactionError"===t.name}class Xi{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(hi("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(hi("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Yi(n)}add(t){return hi("SimpleDb","ADD",this.store.name,t,t),Yi(this.store.add(t))}get(t){return Yi(this.store.get(t)).next((e=>(void 0===e&&(e=null),hi("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return hi("SimpleDb","DELETE",this.store.name,t),Yi(this.store.delete(t))}count(){return hi("SimpleDb","COUNT",this.store.name),Yi(this.store.count())}W(t,e){const n=this.options(t,e),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const t=r.getAll(n.range);return new zi(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}{const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new zi(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}H(t,e){hi("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.J=!1;const r=this.cursor(n);return this.G(r,((t,e,n)=>n.delete()))}Y(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.G(r,e)}Z(t){const e=this.cursor({});return new zi(((n,r)=>{e.onerror=t=>{const e=Zi(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}G(t,e){const n=[];return new zi(((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new Hi(s),o=e(s.primaryKey,s.value,i);if(o instanceof zi){const t=o.catch((t=>(i.done(),zi.reject(t))));n.push(t)}i.isDone?r():null===i.$?s.continue():s.continue(i.$)}})).next((()=>zi.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.J?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Yi(t){return new zi(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Zi(t.target.error);n(e)}}))}let Ji=!1;function Zi(t){const e=Gi.S(c());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new yi("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ji||(Ji=!0,setTimeout((()=>{throw t}),0)),t}}return t}class to{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function eo(t){return null==t}function no(t){return 0===t&&1/t==-1/0}to._e=-1;function ro(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function so(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function io(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class oo{constructor(t,e){this.comparator=t,this.root=e||co.EMPTY}insert(t,e){return new oo(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,co.BLACK,null,null))}remove(t){return new oo(this.comparator,this.root.remove(t,this.comparator).copy(null,null,co.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ao(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ao(this.root,t,this.comparator,!1)}getReverseIterator(){return new ao(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ao(this.root,t,this.comparator,!0)}}class ao{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class co{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:co.RED,this.left=null!=r?r:co.EMPTY,this.right=null!=s?s:co.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new co(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return co.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return co.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,co.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,co.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw fi();if(this.right.isRed())throw fi();const t=this.left.check();if(t!==this.right.check())throw fi();return t+(this.isRed()?0:1)}}co.EMPTY=null,co.RED=!0,co.BLACK=!1,co.EMPTY=new class{constructor(){this.size=0}get key(){throw fi()}get value(){throw fi()}get color(){throw fi()}get left(){throw fi()}get right(){throw fi()}copy(t,e,n,r,s){return this}insert(t,e,n){return new co(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ho{constructor(t){this.comparator=t,this.data=new oo(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new uo(this.data.getIterator())}getIteratorFrom(t){return new uo(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof ho))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new ho(this.comparator);return e.data=t,e}}class uo{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class lo{constructor(t){this.fields=t,t.sort(Pi.comparator)}static empty(){return new lo([])}unionWith(t){let e=new ho(Pi.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new lo(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return ki(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class fo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class po{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new fo("Invalid base64 string: "+t):t}}(t);return new po(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new po(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Ni(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}po.EMPTY_BYTE_STRING=new po("");const go=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mo(t){if(pi(!!t),"string"==typeof t){let e=0;const n=go.exec(t);if(pi(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:yo(t.seconds),nanos:yo(t.nanos)}}function yo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function vo(t){return"string"==typeof t?po.fromBase64String(t):po.fromUint8Array(t)}function wo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Eo(t){const e=t.mapValue.fields.__previous_value__;return wo(e)?Eo(e):e}function bo(t){const e=mo(t.mapValue.fields.__local_write_time__.timestampValue);return new xi(e.seconds,e.nanos)}class _o{constructor(t,e,n,r,s,i,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class To{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new To("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof To&&t.projectId===this.projectId&&t.database===this.database}}const So={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Io(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?wo(t)?4:Fo(t)?9007199254740991:10:fi()}function Co(t,e){if(t===e)return!0;const n=Io(t);if(n!==Io(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return bo(t).isEqual(bo(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=mo(t.timestampValue),r=mo(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return vo(t.bytesValue).isEqual(vo(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return yo(t.geoPointValue.latitude)===yo(e.geoPointValue.latitude)&&yo(t.geoPointValue.longitude)===yo(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return yo(t.integerValue)===yo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=yo(t.doubleValue),r=yo(e.doubleValue);return n===r?no(n)===no(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return ki(t.arrayValue.values||[],e.arrayValue.values||[],Co);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ro(n)!==ro(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Co(n[t],r[t])))return!1;return!0}(t,e);default:return fi()}}function Ao(t,e){return void 0!==(t.values||[]).find((t=>Co(t,e)))}function Do(t,e){if(t===e)return 0;const n=Io(t),r=Io(e);if(n!==r)return Ni(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ni(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=yo(t.integerValue||t.doubleValue),r=yo(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return No(t.timestampValue,e.timestampValue);case 4:return No(bo(t),bo(e));case 5:return Ni(t.stringValue,e.stringValue);case 6:return function(t,e){const n=vo(t),r=vo(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Ni(n[t],r[t]);if(0!==e)return e}return Ni(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Ni(yo(t.latitude),yo(e.latitude));return 0!==n?n:Ni(yo(t.longitude),yo(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Do(n[t],r[t]);if(e)return e}return Ni(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===So.mapValue&&e===So.mapValue)return 0;if(t===So.mapValue)return 1;if(e===So.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=Ni(r[t],i[t]);if(0!==e)return e;const o=Do(n[r[t]],s[i[t]]);if(0!==o)return o}return Ni(r.length,i.length)}(t.mapValue,e.mapValue);default:throw fi()}}function No(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ni(t,e);const n=mo(t),r=mo(e),s=Ni(n.seconds,r.seconds);return 0!==s?s:Ni(n.nanos,r.nanos)}function ko(t){return xo(t)}function xo(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=mo(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return vo(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return Vi.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=xo(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${xo(t.fields[s])}`;return n+"}"}(t.mapValue):fi()}function Ro(t){return!!t&&"integerValue"in t}function Lo(t){return!!t&&"arrayValue"in t}function Oo(t){return!!t&&"nullValue"in t}function Mo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Po(t){return!!t&&"mapValue"in t}function Vo(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return so(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Vo(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Vo(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Fo(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class Uo{constructor(t){this.value=t}static empty(){return new Uo({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Po(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Vo(e)}setAll(t){let e=Pi.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=Vo(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());Po(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Co(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Po(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){so(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Uo(Vo(this.value))}}function Bo(t){const e=[];return so(t.fields,((t,n)=>{const r=new Pi([t]);if(Po(n)){const t=Bo(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new lo(e)}class jo{constructor(t,e,n,r,s,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new jo(t,0,Ri.min(),Ri.min(),Ri.min(),Uo.empty(),0)}static newFoundDocument(t,e,n,r){return new jo(t,1,e,Ri.min(),n,r,0)}static newNoDocument(t,e){return new jo(t,2,e,Ri.min(),Ri.min(),Uo.empty(),0)}static newUnknownDocument(t,e){return new jo(t,3,e,Ri.min(),Ri.min(),Uo.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Ri.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Uo.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Uo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ri.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof jo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new jo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class qo{constructor(t,e){this.position=t,this.inclusive=e}}function $o(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?Vi.comparator(Vi.fromName(o.referenceValue),n.key):Do(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function zo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Co(t.position[n],e.position[n]))return!1;return!0}class Ko{constructor(t,e="asc"){this.field=t,this.dir=e}}function Go(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Ho{}class Qo extends Ho{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new ea(t,e,n):"array-contains"===e?new ia(t,n):"in"===e?new oa(t,n):"not-in"===e?new aa(t,n):"array-contains-any"===e?new ca(t,n):new Qo(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new na(t,n):new ra(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Do(e,this.value)):null!==e&&Io(this.value)===Io(e)&&this.matchesComparison(Do(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return fi()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Wo extends Ho{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new Wo(t,e)}matches(t){return Xo(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Xo(t){return"and"===t.op}function Yo(t){return function(t){for(const e of t.filters)if(e instanceof Wo)return!1;return!0}(t)&&Xo(t)}function Jo(t){if(t instanceof Qo)return t.field.canonicalString()+t.op.toString()+ko(t.value);if(Yo(t))return t.filters.map((t=>Jo(t))).join(",");{const e=t.filters.map((t=>Jo(t))).join(",");return`${t.op}(${e})`}}function Zo(t,e){return t instanceof Qo?function(t,e){return e instanceof Qo&&t.op===e.op&&t.field.isEqual(e.field)&&Co(t.value,e.value)}(t,e):t instanceof Wo?function(t,e){return e instanceof Wo&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&Zo(n,e.filters[r])),!0)}(t,e):void fi()}function ta(t){return t instanceof Qo?function(t){return`${t.field.canonicalString()} ${t.op} ${ko(t.value)}`}(t):t instanceof Wo?function(t){return t.op.toString()+" {"+t.getFilters().map(ta).join(" ,")+"}"}(t):"Filter"}class ea extends Qo{constructor(t,e,n){super(t,e,n),this.key=Vi.fromName(n.referenceValue)}matches(t){const e=Vi.comparator(t.key,this.key);return this.matchesComparison(e)}}class na extends Qo{constructor(t,e){super(t,"in",e),this.keys=sa(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class ra extends Qo{constructor(t,e){super(t,"not-in",e),this.keys=sa(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function sa(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Vi.fromName(t.referenceValue)))}class ia extends Qo{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Lo(e)&&Ao(e.arrayValue,this.value)}}class oa extends Qo{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Ao(this.value.arrayValue,e)}}class aa extends Qo{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ao(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Ao(this.value.arrayValue,e)}}class ca extends Qo{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Lo(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Ao(this.value.arrayValue,t)))}}class ha{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ce=null}}function ua(t,e=null,n=[],r=[],s=null,i=null,o=null){return new ha(t,e,n,r,s,i,o)}function la(t){const e=gi(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Jo(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),eo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>ko(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>ko(t))).join(",")),e.ce=t}return e.ce}function da(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Go(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Zo(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!zo(t.startAt,e.startAt)&&zo(t.endAt,e.endAt)}function fa(t){return Vi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class pa{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function ga(t){return new pa(t)}function ma(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function ya(t){const e=gi(t);if(null===e.le){e.le=[];const t=new Set;for(const n of e.explicitOrderBy)e.le.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new ho(Pi.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new Ko(r,n))})),t.has(Pi.keyField().canonicalString())||e.le.push(new Ko(Pi.keyField(),n))}return e.le}function va(t){const e=gi(t);return e.he||(e.he=function(t,e){if("F"===t.limitType)return ua(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new Ko(t.field,e)}));const n=t.endAt?new qo(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new qo(t.startAt.position,t.startAt.inclusive):null;return ua(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,ya(t))),e.he}function wa(t,e,n){return new pa(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ea(t,e){return da(va(t),va(e))&&t.limitType===e.limitType}function ba(t){return`${la(va(t))}|lt:${t.limitType}`}function _a(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>ta(t))).join(", ")}]`),eo(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>ko(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>ko(t))).join(",")),`Target(${e})`}(va(t))}; limitType=${t.limitType})`}function Ta(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Vi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of ya(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=$o(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,ya(t),e)||t.endAt&&!function(t,e,n){const r=$o(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,ya(t),e))}(t,e)}function Sa(t){return(e,n)=>{let r=!1;for(const s of ya(t)){const t=Ia(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function Ia(t,e,n){const r=t.field.isKeyField()?Vi.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?Do(r,s):fi()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return fi()}}class Ca{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){so(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return io(this.inner)}size(){return this.innerSize}}const Aa=new oo(Vi.comparator);function Da(){return Aa}const Na=new oo(Vi.comparator);function ka(...t){let e=Na;for(const n of t)e=e.insert(n.key,n);return e}function xa(t){let e=Na;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Ra(){return Oa()}function La(){return Oa()}function Oa(){return new Ca((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Ma=new oo(Vi.comparator),Pa=new ho(Vi.comparator);function Va(...t){let e=Pa;for(const n of t)e=e.add(n);return e}const Fa=new ho(Ni);function Ua(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:no(e)?"-0":e}}function Ba(t){return{integerValue:""+t}}function ja(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!no(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?Ba(e):Ua(t,e)}class qa{constructor(){this._=void 0}}function $a(t,e,n){return t instanceof Ga?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&wo(e)&&(e=Eo(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ha?Qa(t,e):t instanceof Wa?Xa(t,e):function(t,e){const n=Ka(t,e),r=Ja(n)+Ja(t.Ie);return Ro(n)&&Ro(t.Ie)?Ba(r):Ua(t.serializer,r)}(t,e)}function za(t,e,n){return t instanceof Ha?Qa(t,e):t instanceof Wa?Xa(t,e):n}function Ka(t,e){return t instanceof Ya?function(t){return Ro(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class Ga extends qa{}class Ha extends qa{constructor(t){super(),this.elements=t}}function Qa(t,e){const n=Za(e);for(const e of t.elements)n.some((t=>Co(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Wa extends qa{constructor(t){super(),this.elements=t}}function Xa(t,e){let n=Za(e);for(const e of t.elements)n=n.filter((t=>!Co(t,e)));return{arrayValue:{values:n}}}class Ya extends qa{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function Ja(t){return yo(t.integerValue||t.doubleValue)}function Za(t){return Lo(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class tc{constructor(t,e){this.version=t,this.transformResults=e}}class ec{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ec}static exists(t){return new ec(void 0,t)}static updateTime(t){return new ec(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function nc(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class rc{}function sc(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new pc(t.key,ec.none()):new hc(t.key,t.data,ec.none());{const n=t.data,r=Uo.empty();let s=new ho(Pi.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new uc(t.key,r,new lo(s.toArray()),ec.none())}}function ic(t,e,n){t instanceof hc?function(t,e,n){const r=t.value.clone(),s=dc(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof uc?function(t,e,n){if(!nc(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=dc(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(lc(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function oc(t,e,n,r){return t instanceof hc?function(t,e,n,r){if(!nc(t.precondition,e))return n;const s=t.value.clone(),i=fc(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof uc?function(t,e,n,r){if(!nc(t.precondition,e))return n;const s=fc(t.fieldTransforms,r,e),i=e.data;return i.setAll(lc(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return nc(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function ac(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=Ka(r.transform,t||null);null!=s&&(null===n&&(n=Uo.empty()),n.set(r.field,s))}return n||null}function cc(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ki(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ha&&e instanceof Ha||t instanceof Wa&&e instanceof Wa?ki(t.elements,e.elements,Co):t instanceof Ya&&e instanceof Ya?Co(t.Ie,e.Ie):t instanceof Ga&&e instanceof Ga}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class hc extends rc{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class uc extends rc{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function lc(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function dc(t,e,n){const r=new Map;pi(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,za(o,a,n[s]))}return r}function fc(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,$a(t,i,e))}return r}class pc extends rc{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class gc extends rc{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class mc{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&ic(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=oc(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=oc(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=La();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=sc(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(Ri.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Va())}isEqual(t){return this.batchId===t.batchId&&ki(this.mutations,t.mutations,((t,e)=>cc(t,e)))&&ki(this.baseMutations,t.baseMutations,((t,e)=>cc(t,e)))}}class yc{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){pi(t.mutations.length===n.length);let r=Ma;const s=t.mutations;for(let t=0;t<s.length;t++)r=r.insert(s[t].key,n[t].version);return new yc(t,e,n,r)}}class vc{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class wc{constructor(t,e){this.count=t,this.unchangedNames=e}}var Ec,bc;function _c(t){if(void 0===t)return ui("GRPC error has no .code"),mi.UNKNOWN;switch(t){case Ec.OK:return mi.OK;case Ec.CANCELLED:return mi.CANCELLED;case Ec.UNKNOWN:return mi.UNKNOWN;case Ec.DEADLINE_EXCEEDED:return mi.DEADLINE_EXCEEDED;case Ec.RESOURCE_EXHAUSTED:return mi.RESOURCE_EXHAUSTED;case Ec.INTERNAL:return mi.INTERNAL;case Ec.UNAVAILABLE:return mi.UNAVAILABLE;case Ec.UNAUTHENTICATED:return mi.UNAUTHENTICATED;case Ec.INVALID_ARGUMENT:return mi.INVALID_ARGUMENT;case Ec.NOT_FOUND:return mi.NOT_FOUND;case Ec.ALREADY_EXISTS:return mi.ALREADY_EXISTS;case Ec.PERMISSION_DENIED:return mi.PERMISSION_DENIED;case Ec.FAILED_PRECONDITION:return mi.FAILED_PRECONDITION;case Ec.ABORTED:return mi.ABORTED;case Ec.OUT_OF_RANGE:return mi.OUT_OF_RANGE;case Ec.UNIMPLEMENTED:return mi.UNIMPLEMENTED;case Ec.DATA_LOSS:return mi.DATA_LOSS;default:return fi()}}(bc=Ec||(Ec={}))[bc.OK=0]="OK",bc[bc.CANCELLED=1]="CANCELLED",bc[bc.UNKNOWN=2]="UNKNOWN",bc[bc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bc[bc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bc[bc.NOT_FOUND=5]="NOT_FOUND",bc[bc.ALREADY_EXISTS=6]="ALREADY_EXISTS",bc[bc.PERMISSION_DENIED=7]="PERMISSION_DENIED",bc[bc.UNAUTHENTICATED=16]="UNAUTHENTICATED",bc[bc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bc[bc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bc[bc.ABORTED=10]="ABORTED",bc[bc.OUT_OF_RANGE=11]="OUT_OF_RANGE",bc[bc.UNIMPLEMENTED=12]="UNIMPLEMENTED",bc[bc.INTERNAL=13]="INTERNAL",bc[bc.UNAVAILABLE=14]="UNAVAILABLE",bc[bc.DATA_LOSS=15]="DATA_LOSS";const Tc=new ri([4294967295,4294967295],0);function Sc(t){const e=(new TextEncoder).encode(t),n=new ni;return n.update(e),new Uint8Array(n.digest())}function Ic(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ri([n,r],0),new ri([s,i],0)]}class Cc{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Ac(`Invalid padding: ${e}`);if(n<0)throw new Ac(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Ac(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Ac(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=ri.fromNumber(this.Te)}de(t,e,n){let r=t.add(e.multiply(ri.fromNumber(n)));return 1===r.compare(Tc)&&(r=new ri([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=Sc(t),[n,r]=Ic(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);if(!this.Ae(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new Cc(s,r,e);return n.forEach((t=>i.insert(t))),i}insert(t){if(0===this.Te)return;const e=Sc(t),[n,r]=Ic(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);this.Re(e)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Ac extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Dc{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Nc.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Dc(Ri.min(),r,new oo(Ni),Da(),Va())}}class Nc{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Nc(n,e,Va(),Va(),Va())}}class kc{constructor(t,e,n,r){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=r}}class xc{constructor(t,e){this.targetId=t,this.fe=e}}class Rc{constructor(t,e,n=po.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Lc{constructor(){this.ge=0,this.pe=Pc(),this.ye=po.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=Va(),e=Va(),n=Va();return this.pe.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:fi()}})),new Nc(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=Pc()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,pi(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class Oc{constructor(t){this.Le=t,this.ke=new Map,this.qe=Da(),this.Qe=Mc(),this.Ke=new oo(Ni)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Be(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:fi()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,r=this.Ye(e);if(r){const s=r.target;if(fa(s))if(0===n){const t=new Vi(s.path);this.We(e,t,jo.newNoDocument(t,Ri.min()))}else pi(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),s=n?this.et(n,t,r):1;if(0!==s){this.He(e);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=e;let i,o;try{i=vo(n).toUint8Array()}catch(t){if(t instanceof fo)return li("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new Cc(i,r,s)}catch(t){return li(t instanceof Ac?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const s=this.Le.nt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;t.mightContain(i)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.ke.forEach(((n,r)=>{const s=this.Ye(r);if(s){if(n.current&&fa(s.target)){const e=new Vi(s.target.path);null!==this.qe.get(e)||this.st(r,e)||this.We(r,e,jo.newNoDocument(e,t))}n.De&&(e.set(r,n.ve()),n.Fe())}}));let n=Va();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const r=new Dc(t,e,this.Ke,this.qe,n);return this.qe=Da(),this.Qe=Mc(),this.Ke=new oo(Ni),r}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new Lc,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new ho(Ni),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||hi("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Le._t(t)}He(t){this.ke.set(t,new Lc),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function Mc(){return new oo(Vi.comparator)}function Pc(){return new oo(Vi.comparator)}const Vc={asc:"ASCENDING",desc:"DESCENDING"},Fc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Uc={and:"AND",or:"OR"};class Bc{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function jc(t,e){return t.useProto3Json||eo(e)?e:{value:e}}function qc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function $c(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function zc(t,e){return qc(t,e.toTimestamp())}function Kc(t){return pi(!!t),Ri.fromTimestamp(function(t){const e=mo(t);return new xi(e.seconds,e.nanos)}(t))}function Gc(t,e){return Hc(t,e).canonicalString()}function Hc(t,e){const n=function(t){return new Oi(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Qc(t){const e=Oi.fromString(t);return pi(dh(e)),e}function Wc(t,e){return Gc(t.databaseId,e.path)}function Xc(t,e){const n=Qc(e);if(n.get(1)!==t.databaseId.projectId)throw new yi(mi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new yi(mi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Vi(Zc(n))}function Yc(t,e){return Gc(t.databaseId,e)}function Jc(t){return new Oi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Zc(t){return pi(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function th(t,e,n){return{name:Wc(t,e),fields:n.value.mapValue.fields}}function eh(t,e){return{documents:[Yc(t,e.path)]}}function nh(t,e){const n={structuredQuery:{}},r=e.path;let s;null!==e.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Yc(t,s);const i=function(t){if(0!==t.length)return uh(Wo.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:ch(t.field),direction:ih(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=jc(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ut:n,parent:s}}function rh(t){let e=function(t){const e=Qc(t);return 4===e.length?Oi.emptyPath():Zc(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){pi(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=sh(t);return e instanceof Wo&&Yo(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new Ko(hh(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,eo(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new qo(n,e)}(n.startAt));let h=null;return n.endAt&&(h=function(t){const e=!t.before,n=t.values||[];return new qo(n,e)}(n.endAt)),function(t,e,n,r,s,i,o,a){return new pa(t,e,n,r,s,i,o,a)}(e,s,o,i,a,"F",c,h)}function sh(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=hh(t.unaryFilter.field);return Qo.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=hh(t.unaryFilter.field);return Qo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=hh(t.unaryFilter.field);return Qo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=hh(t.unaryFilter.field);return Qo.create(s,"!=",{nullValue:"NULL_VALUE"});default:return fi()}}(t):void 0!==t.fieldFilter?function(t){return Qo.create(hh(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return fi()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Wo.create(t.compositeFilter.filters.map((t=>sh(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return fi()}}(t.compositeFilter.op))}(t):fi()}function ih(t){return Vc[t]}function oh(t){return Fc[t]}function ah(t){return Uc[t]}function ch(t){return{fieldPath:t.canonicalString()}}function hh(t){return Pi.fromServerFormat(t.fieldPath)}function uh(t){return t instanceof Qo?function(t){if("=="===t.op){if(Mo(t.value))return{unaryFilter:{field:ch(t.field),op:"IS_NAN"}};if(Oo(t.value))return{unaryFilter:{field:ch(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Mo(t.value))return{unaryFilter:{field:ch(t.field),op:"IS_NOT_NAN"}};if(Oo(t.value))return{unaryFilter:{field:ch(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ch(t.field),op:oh(t.op),value:t.value}}}(t):t instanceof Wo?function(t){const e=t.getFilters().map((t=>uh(t)));return 1===e.length?e[0]:{compositeFilter:{op:ah(t.op),filters:e}}}(t):fi()}function lh(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function dh(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class fh{constructor(t,e,n,r,s=Ri.min(),i=Ri.min(),o=po.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new fh(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new fh(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new fh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new fh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class ph{constructor(t){this.ct=t}}function gh(t){const e=rh({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?wa(e,e.limit,"L"):e}class mh{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(yo(t.integerValue));else if("doubleValue"in t){const n=yo(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),no(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Et(e,20),"string"==typeof n?e.At(n):(e.At(`${n.seconds||""}`),e.dt(n.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(vo(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?Fo(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):fi()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),Vi.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}mh.bt=new mh;class yh{constructor(){this._n=new vh}addToCollectionParentIndex(t,e){return this._n.add(e),zi.resolve()}getCollectionParents(t,e){return zi.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return zi.resolve()}deleteFieldIndex(t,e){return zi.resolve()}deleteAllFieldIndexes(t){return zi.resolve()}createTargetIndexes(t,e){return zi.resolve()}getDocumentsMatchingTarget(t,e){return zi.resolve(null)}getIndexType(t,e){return zi.resolve(0)}getFieldIndexes(t,e){return zi.resolve([])}getNextCollectionGroupToUpdate(t){return zi.resolve(null)}getMinOffset(t,e){return zi.resolve(Ui.min())}getMinOffsetFromCollectionGroup(t,e){return zi.resolve(Ui.min())}updateCollectionGroup(t,e,n){return zi.resolve()}updateIndexEntries(t,e){return zi.resolve()}}class vh{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ho(Oi.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new ho(Oi.comparator)).toArray()}}new Uint8Array(0);class wh{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new wh(t,wh.DEFAULT_COLLECTION_PERCENTILE,wh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}wh.DEFAULT_COLLECTION_PERCENTILE=10,wh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wh.DEFAULT=new wh(41943040,wh.DEFAULT_COLLECTION_PERCENTILE,wh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wh.DISABLED=new wh(-1,0,0);class Eh{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new Eh(0)}static Bn(){return new Eh(-1)}}class bh{constructor(){this.changes=new Ca((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,jo.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?zi.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class _h{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Th{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&oc(n.mutation,t,lo.empty(),xi.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Va()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Va()){const r=Ra();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=ka();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Ra();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Va())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=Da();const i=Oa(),o=Oa();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof uc)?s=s.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),oc(o.mutation,e,o.mutation.getFieldMask(),xi.now())):i.set(e.key,lo.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new _h(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Oa();let r=new oo(((t,e)=>t-e)),s=Va();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||lo.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||Va()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,h=La();c.forEach((t=>{if(!s.has(t)){const r=sc(e.get(t),n.get(t));null!==r&&h.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,h))}return zi.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return Vi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):zi.resolve(Ra());let o=-1,a=s;return i.next((e=>zi.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?zi.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,Va()))).next((t=>({batchId:o,changes:xa(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Vi(e)).next((t=>{let e=ka();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const s=e.collectionGroup;let i=ka();return this.indexManager.getCollectionParents(t,s).next((o=>zi.forEach(o,(o=>{const a=function(t,e){return new pa(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(s));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,r)))).next((t=>{s.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,jo.newInvalidDocument(r)))}));let n=ka();return t.forEach(((t,r)=>{const i=s.get(t);void 0!==i&&oc(i.mutation,r,lo.empty(),xi.now()),Ta(e,r)&&(n=n.insert(t,r))})),n}))}}class Sh{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return zi.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Kc(t.createTime)}}(e)),zi.resolve()}getNamedQuery(t,e){return zi.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:gh(t.bundledQuery),readTime:Kc(t.readTime)}}(e)),zi.resolve()}}class Ih{constructor(){this.overlays=new oo(Vi.comparator),this.hr=new Map}getOverlay(t,e){return zi.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Ra();return zi.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),zi.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),zi.resolve()}getOverlaysForCollection(t,e,n){const r=Ra(),s=e.length+1,i=new Vi(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return zi.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new oo(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Ra(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Ra(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return zi.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new vc(e,n));let s=this.hr.get(e);void 0===s&&(s=Va(),this.hr.set(e,s)),this.hr.set(e,s.add(n.key))}}class Ch{constructor(){this.Pr=new ho(Ah.Ir),this.Tr=new ho(Ah.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new Ah(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new Ah(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new Vi(new Oi([])),n=new Ah(e,t),r=new Ah(e,t+1),s=[];return this.Tr.forEachInRange([n,r],(t=>{this.Ar(t),s.push(t.key)})),s}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new Vi(new Oi([])),n=new Ah(e,t),r=new Ah(e,t+1);let s=Va();return this.Tr.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new Ah(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Ah{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return Vi.comparator(t.key,e.key)||Ni(t.pr,e.pr)}static Er(t,e){return Ni(t.pr,e.pr)||Vi.comparator(t.key,e.key)}}class Dh{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new ho(Ah.Ir)}checkEmpty(t){return zi.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new mc(s,e,n,r);this.mutationQueue.push(i);for(const e of r)this.wr=this.wr.add(new Ah(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return zi.resolve(i)}lookupMutationBatch(t,e){return zi.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.br(n),s=r<0?0:r;return zi.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return zi.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return zi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Ah(e,0),r=new Ah(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,r],(t=>{const e=this.Sr(t.pr);s.push(e)})),zi.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new ho(Ni);return e.forEach((t=>{const e=new Ah(t,0),r=new Ah(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,r],(t=>{n=n.add(t.pr)}))})),zi.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;Vi.isDocumentKey(s)||(s=s.child(""));const i=new Ah(new Vi(s),0);let o=new ho(Ni);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.pr)),!0)}),i),zi.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){pi(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return zi.forEach(e.mutations,(r=>{const s=new Ah(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new Ah(e,0),r=this.wr.firstAfterOrEqual(n);return zi.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,zi.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Nh{constructor(t){this.vr=t,this.docs=new oo(Vi.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return zi.resolve(n?n.document.mutableCopy():jo.newInvalidDocument(e))}getEntries(t,e){let n=Da();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():jo.newInvalidDocument(t))})),zi.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let s=Da();const i=e.path,o=new Vi(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||Bi(Fi(o),n)<=0||(r.has(o.key)||Ta(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return zi.resolve(s)}getAllFromCollectionGroup(t,e,n,r){fi()}Fr(t,e){return zi.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new kh(this)}getSize(t){return zi.resolve(this.size)}}class kh extends bh{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(n)})),zi.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class xh{constructor(t){this.persistence=t,this.Mr=new Ca((t=>la(t)),da),this.lastRemoteSnapshotVersion=Ri.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Ch,this.targetCount=0,this.Br=Eh.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),zi.resolve()}getLastRemoteSnapshotVersion(t){return zi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return zi.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Br.next(),zi.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),zi.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Br=new Eh(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,zi.resolve()}updateTargetData(t,e){return this.qn(e),zi.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,zi.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Mr.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),zi.waitFor(s).next((()=>r))}getTargetCount(t){return zi.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return zi.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),zi.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),zi.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),zi.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return zi.resolve(n)}containsKey(t,e){return zi.resolve(this.Nr.containsKey(e))}}class Rh{constructor(t,e){this.Lr={},this.overlays={},this.kr=new to(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new xh(this),this.indexManager=new yh,this.remoteDocumentCache=function(t){return new Nh(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new ph(e),this.$r=new Sh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Ih,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Lr[t.toKey()];return n||(n=new Dh(e,this.referenceDelegate),this.Lr[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){hi("MemoryPersistence","Starting transaction:",t);const r=new Lh(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((t=>this.referenceDelegate.Wr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gr(t,e){return zi.or(Object.values(this.Lr).map((n=>()=>n.containsKey(t,e))))}}class Lh extends qi{constructor(t){super(),this.currentSequenceNumber=t}}class Oh{constructor(t){this.persistence=t,this.zr=new Ch,this.jr=null}static Hr(t){return new Oh(t)}get Jr(){if(this.jr)return this.jr;throw fi()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),zi.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),zi.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),zi.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return zi.forEach(this.Jr,(n=>{const r=Vi.fromPath(n);return this.Yr(t,r).next((t=>{t||e.removeEntry(r,Ri.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return zi.or([()=>zi.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class Mh{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=r}static Ki(t,e){let n=Va(),r=Va();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Mh(t,e.fromCache,n,r)}}class Ph{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Vh{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){var t;const e=null===(t=i())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()||!navigator.userAgent.includes("Safari")||navigator.userAgent.includes("Chrome")?Gi.v(c())>0?6:4:8}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,r){const s={result:null};return this.ji(t,e).next((t=>{s.result=t})).next((()=>{if(!s.result)return this.Hi(t,e,r,n).next((t=>{s.result=t}))})).next((()=>{if(s.result)return;const n=new Ph;return this.Ji(t,e,n).next((r=>{if(s.result=r,this.Ui)return this.Yi(t,e,n,r.size)}))})).next((()=>s.result))}Yi(t,e,n,r){return n.documentReadCount<this.Wi?(ci()<=b.DEBUG&&hi("QueryEngine","SDK will not create cache indexes for query:",_a(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),zi.resolve()):(ci()<=b.DEBUG&&hi("QueryEngine","Query:",_a(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(ci()<=b.DEBUG&&hi("QueryEngine","The SDK decides to create cache indexes for query:",_a(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,va(e))):zi.resolve())}ji(t,e){if(ma(e))return zi.resolve(null);let n=va(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=wa(e,null,"F"),n=va(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=Va(...r);return this.zi.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.Zi(e,r);return this.Xi(e,i,s,n.readTime)?this.ji(t,wa(e,null,"F")):this.es(t,i,e,n)}))))})))))}Hi(t,e,n,r){return ma(e)||r.isEqual(Ri.min())?zi.resolve(null):this.zi.getDocuments(t,n).next((s=>{const i=this.Zi(e,s);return this.Xi(e,i,n,r)?zi.resolve(null):(ci()<=b.DEBUG&&hi("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),_a(e)),this.es(t,i,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Ri.fromTimestamp(1e9===r?new xi(n+1,0):new xi(n,r));return new Ui(s,Vi.empty(),e)}(r,-1)).next((t=>t)))}))}Zi(t,e){let n=new ho(Sa(t));return e.forEach(((e,r)=>{Ta(t,r)&&(n=n.add(r))})),n}Xi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ji(t,e,n){return ci()<=b.DEBUG&&hi("QueryEngine","Using full collection scan to execute query:",_a(e)),this.zi.getDocumentsMatchingQuery(t,e,Ui.min(),n)}es(t,e,n,r){return this.zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Fh{constructor(t,e,n,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new oo(Ni),this.rs=new Ca((t=>la(t)),da),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Th(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}async function Uh(t,e){const n=gi(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=Va();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function Bh(t){const e=gi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}function jh(t,e){const n=gi(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function qh(t,e,n){const r=gi(t),s=r.ns.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Wi(t))throw t;hi("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ns=r.ns.remove(e),r.rs.delete(s.target)}function $h(t,e,n){const r=gi(t);let s=Ri.min(),i=Va();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=gi(t),s=r.rs.get(n);return void 0!==s?zi.resolve(r.ns.get(s)):r.Qr.getTargetData(e,n)}(r,t,va(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.ts.getDocumentsMatchingQuery(t,e,n?s:Ri.min(),n?i:Va()))).next((t=>(function(t,e,n){let r=t.ss.get(e)||Ri.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ss.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,hs:i})))))}class zh{constructor(){this.activeTargetIds=Fa}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Kh{constructor(){this.no=new zh,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new zh,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Gh{io(t){}shutdown(){}}class Hh{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){hi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){hi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Qh=null;function Wh(){return null===Qh?Qh=268435456+Math.round(2147483648*Math.random()):Qh++,"0x"+Qh.toString(16)}const Xh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Yh{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}}const Jh="WebChannelConnection";class Zh extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=e+"://"+t.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(t,e,n,r,s){const i=Wh(),o=this.bo(t,e.toUriEncodedString());hi("RestConnection",`Sending RPC '${t}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,s),this.Co(t,o,a,n).then((e=>(hi("RestConnection",`Received RPC '${t}' ${i}: `,e),e)),(e=>{throw li("RestConnection",`RPC '${t}' ${i} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,r,s,i){return this.So(t,e,n,r,s)}Do(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+oi,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}bo(t,e){const n=Xh[t];return`${this.fo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,n,r){const s=Wh();return new Promise(((i,o)=>{const a=new ei;a.setWithCredentials(!0),a.listenOnce(Ys.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Xs.NO_ERROR:const e=a.getResponseJson();hi(Jh,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case Xs.TIMEOUT:hi(Jh,`RPC '${t}' ${s} timed out`),o(new yi(mi.DEADLINE_EXCEEDED,"Request time out"));break;case Xs.HTTP_ERROR:const n=a.getStatus();if(hi(Jh,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(mi).indexOf(e)>=0?e:mi.UNKNOWN}(e.status);o(new yi(t,e.message))}else o(new yi(mi.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new yi(mi.UNAVAILABLE,"Connection failed."));break;default:fi()}}finally{hi(Jh,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(r);hi(Jh,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",c,n,15)}))}Fo(t,e,n){const r=Wh(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Qs(),o=Ws(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const h=s.join("");hi(Jh,`Creating RPC '${t}' stream ${r}: ${h}`,a);const u=i.createWebChannel(h,a);let l=!1,d=!1;const f=new Yh({lo:e=>{d?hi(Jh,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(hi(Jh,`Opening RPC '${t}' stream ${r} transport.`),u.open(),l=!0),hi(Jh,`RPC '${t}' stream ${r} sending:`,e),u.send(e))},ho:()=>u.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(u,ti.EventType.OPEN,(()=>{d||hi(Jh,`RPC '${t}' stream ${r} transport opened.`)})),p(u,ti.EventType.CLOSE,(()=>{d||(d=!0,hi(Jh,`RPC '${t}' stream ${r} transport closed`),f.Vo())})),p(u,ti.EventType.ERROR,(e=>{d||(d=!0,li(Jh,`RPC '${t}' stream ${r} transport errored:`,e),f.Vo(new yi(mi.UNAVAILABLE,"The operation could not be completed")))})),p(u,ti.EventType.MESSAGE,(e=>{var n;if(!d){const s=e.data[0];pi(!!s);const i=s,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){hi(Jh,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Ec[t];if(void 0!==e)return _c(e)}(e),s=o.message;void 0===n&&(n=mi.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.Vo(new yi(n,s)),u.close()}else hi(Jh,`RPC '${t}' stream ${r} received:`,s),f.mo(s)}})),p(o,Js.STAT_EVENT,(e=>{e.stat===Zs.PROXY?hi(Jh,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Zs.NOPROXY&&hi(Jh,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function tu(){return"undefined"!=typeof document?document:null}function eu(t){return new Bc(t,!0)}class nu{constructor(t,e,n=1e3,r=1.5,s=6e4){this.oi=t,this.timerId=e,this.Mo=n,this.xo=r,this.Oo=s,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();const e=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,e-n);r>0&&hi("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Lo=Date.now(),t()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class ru{constructor(t,e,n,r,s,i,o,a){this.oi=t,this.$o=n,this.Uo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new nu(t,e)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(t){this.n_(),this.stream.send(t)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(t,e){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==t?this.jo.reset():e&&e.code===mi.RESOURCE_EXHAUSTED?(ui(e.toString()),ui("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===mi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.To(e)}i_(){}auth(){this.state=1;const t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Wo===e&&this.o_(t,n)}),(e=>{t((()=>{const t=new yi(mi.UNKNOWN,"Fetching auth token failed: "+e.message);return this.__(t)}))}))}o_(t,e){const n=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((t=>{n((()=>this.__(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(t){return hi("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget((()=>this.Wo===t?e():(hi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class su extends ru{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:fi()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(pi(void 0===e||"string"==typeof e),po.fromBase64String(e||"")):(pi(void 0===e||e instanceof Uint8Array),po.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?mi.UNKNOWN:_c(t.code);return new yi(e,t.message||"")}(o);n=new Rc(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Xc(t,r.document.name),i=Kc(r.document.updateTime),o=r.document.createTime?Kc(r.document.createTime):Ri.min(),a=new Uo({mapValue:{fields:r.document.fields}}),c=jo.newFoundDocument(s,i,o,a),h=r.targetIds||[],u=r.removedTargetIds||[];n=new kc(h,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Xc(t,r.document),i=r.readTime?Kc(r.readTime):Ri.min(),o=jo.newNoDocument(s,i),a=r.removedTargetIds||[];n=new kc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Xc(t,r.document),i=r.removedTargetIds||[];n=new kc([],i,s,null)}else{if(!("filter"in e))return fi();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:s}=t,i=new wc(r,s),o=t.targetId;n=new xc(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Ri.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Ri.min():e.readTime?Kc(e.readTime):Ri.min()}(t);return this.listener.u_(e,n)}c_(t){const e={};e.database=Jc(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=fa(r)?{documents:eh(t,r)}:{query:nh(t,r).ut},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=$c(t,e.resumeToken);const r=jc(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(Ri.min())>0){n.readTime=qc(t,e.snapshotVersion.toTimestamp());const r=jc(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fi()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.t_(e)}l_(t){const e={};e.database=Jc(this.serializer),e.removeTarget=t,this.t_(e)}}class iu extends ru{constructor(t,e,n,r,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(pi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();const e=function(t,e){return t&&t.length>0?(pi(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Kc(t.updateTime):Kc(e);return n.isEqual(Ri.min())&&(n=Kc(e)),new tc(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Kc(t.commitTime);return this.listener.T_(n,e)}return pi(!t.writeResults||0===t.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const t={};t.database=Jc(this.serializer),this.t_(t)}I_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof hc)n={update:th(t,e.key,e.value)};else if(e instanceof pc)n={delete:Wc(t,e.key)};else if(e instanceof uc)n={update:th(t,e.key,e.data),updateMask:lh(e.fieldMask)};else{if(!(e instanceof gc))return fi();n={verify:Wc(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ga)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ha)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Wa)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ya)return{fieldPath:e.field.canonicalString(),increment:n.Ie};throw fi()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:zc(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:fi()}(t,e.precondition)),n}(this.serializer,t)))};this.t_(e)}}class ou extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new yi(mi.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.So(t,Hc(e,n),r,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===mi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new yi(mi.UNKNOWN,t.toString())}))}vo(t,e,n,r,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.vo(t,Hc(e,n),r,i,o,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===mi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new yi(mi.UNKNOWN,t.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class au{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(t){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,"Online"===t&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(ui(e),this.g_=!1):hi("OnlineStateTracker",e)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class cu{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io((t=>{n.enqueueAndForget((async()=>{yu(this)&&(hi("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=gi(t);e.v_.add(4),await uu(e),e.x_.set("Unknown"),e.v_.delete(4),await hu(e)}(this))}))})),this.x_=new au(n,r)}}async function hu(t){if(yu(t))for(const e of t.F_)await e(!0)}async function uu(t){for(const e of t.F_)await e(!1)}function lu(t,e){const n=gi(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),mu(n)?gu(n):Ou(n).Jo()&&fu(n,e))}function du(t,e){const n=gi(t),r=Ou(n);n.C_.delete(e),r.Jo()&&pu(n,e),0===n.C_.size&&(r.Jo()?r.Xo():yu(n)&&n.x_.set("Unknown"))}function fu(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ri.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ou(t).c_(e)}function pu(t,e){t.O_.Oe(e),Ou(t).l_(e)}function gu(t){t.O_=new Oc({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Ou(t).start(),t.x_.p_()}function mu(t){return yu(t)&&!Ou(t).Ho()&&t.C_.size>0}function yu(t){return 0===gi(t).v_.size}function vu(t){t.O_=void 0}async function wu(t){t.C_.forEach(((e,n)=>{fu(t,e)}))}async function Eu(t,e){vu(t),mu(t)?(t.x_.S_(e),gu(t)):t.x_.set("Unknown")}async function bu(t,e,n){if(t.x_.set("Online"),e instanceof Rc&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.C_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.C_.delete(r),t.O_.removeTarget(r))}(t,e)}catch(n){hi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await _u(t,n)}else if(e instanceof kc?t.O_.$e(e):e instanceof xc?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(Ri.min()))try{const e=await Bh(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.O_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.C_.get(r);s&&t.C_.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.C_.get(e);if(!r)return;t.C_.set(e,r.withResumeToken(po.EMPTY_BYTE_STRING,r.snapshotVersion)),pu(t,e);const s=new fh(r.target,e,n,r.sequenceNumber);fu(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){hi("RemoteStore","Failed to raise snapshot:",e),await _u(t,e)}}async function _u(t,e,n){if(!Wi(e))throw e;t.v_.add(1),await uu(t),t.x_.set("Offline"),n||(n=()=>Bh(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{hi("RemoteStore","Retrying IndexedDB access"),await n(),t.v_.delete(1),await hu(t)}))}function Tu(t,e){return e().catch((n=>_u(t,n,e)))}async function Su(t){const e=gi(t),n=Mu(e);let r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;Iu(e);)try{const t=await jh(e.localStore,r);if(null===t){0===e.D_.length&&n.Xo();break}r=t.batchId,Cu(e,t)}catch(t){await _u(e,t)}Au(e)&&Du(e)}function Iu(t){return yu(t)&&t.D_.length<10}function Cu(t,e){t.D_.push(e);const n=Mu(t);n.Jo()&&n.P_&&n.I_(e.mutations)}function Au(t){return yu(t)&&!Mu(t).Ho()&&t.D_.length>0}function Du(t){Mu(t).start()}async function Nu(t){Mu(t).d_()}async function ku(t){const e=Mu(t);for(const n of t.D_)e.I_(n.mutations)}async function xu(t,e,n){const r=t.D_.shift(),s=yc.from(r,e,n);await Tu(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await Su(t)}async function Ru(t,e){e&&Mu(t).P_&&await async function(t,e){if(function(t){return function(t){switch(t){default:return fi();case mi.CANCELLED:case mi.UNKNOWN:case mi.DEADLINE_EXCEEDED:case mi.RESOURCE_EXHAUSTED:case mi.INTERNAL:case mi.UNAVAILABLE:case mi.UNAUTHENTICATED:return!1;case mi.INVALID_ARGUMENT:case mi.NOT_FOUND:case mi.ALREADY_EXISTS:case mi.PERMISSION_DENIED:case mi.FAILED_PRECONDITION:case mi.ABORTED:case mi.OUT_OF_RANGE:case mi.UNIMPLEMENTED:case mi.DATA_LOSS:return!0}}(t)&&t!==mi.ABORTED}(e.code)){const n=t.D_.shift();Mu(t).Zo(),await Tu(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Su(t)}}(t,e),Au(t)&&Du(t)}async function Lu(t,e){const n=gi(t);n.asyncQueue.verifyOperationInProgress(),hi("RemoteStore","RemoteStore received new credentials");const r=yu(n);n.v_.add(3),await uu(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),await hu(n)}function Ou(t){return t.N_||(t.N_=function(t,e,n){const r=gi(t);return r.R_(),new su(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:wu.bind(null,t),To:Eu.bind(null,t),u_:bu.bind(null,t)}),t.F_.push((async e=>{e?(t.N_.Zo(),mu(t)?gu(t):t.x_.set("Unknown")):(await t.N_.stop(),vu(t))}))),t.N_}function Mu(t){return t.B_||(t.B_=function(t,e,n){const r=gi(t);return r.R_(),new iu(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:Nu.bind(null,t),To:Ru.bind(null,t),E_:ku.bind(null,t),T_:xu.bind(null,t)}),t.F_.push((async e=>{e?(t.B_.Zo(),await Su(t)):(await t.B_.stop(),t.D_.length>0&&(hi("RemoteStore",`Stopping write stream with ${t.D_.length} pending writes`),t.D_=[]))}))),t.B_}class Pu{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new vi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new Pu(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new yi(mi.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Vu(t,e){if(ui("AsyncQueue",`${e}: ${t}`),Wi(t))return new yi(mi.UNAVAILABLE,`${e}: ${t}`);throw t}class Fu{constructor(t){this.comparator=t?(e,n)=>t(e,n)||Vi.comparator(e.key,n.key):(t,e)=>Vi.comparator(t.key,e.key),this.keyedMap=ka(),this.sortedSet=new oo(this.comparator)}static emptySet(t){return new Fu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Fu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Fu;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Uu{constructor(){this.L_=new oo(Vi.comparator)}track(t){const e=t.doc.key,n=this.L_.get(e);n?0!==t.type&&3===n.type?this.L_=this.L_.insert(e,t):3===t.type&&1!==n.type?this.L_=this.L_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.L_=this.L_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.L_=this.L_.remove(e):1===t.type&&2===n.type?this.L_=this.L_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):fi():this.L_=this.L_.insert(e,t)}k_(){const t=[];return this.L_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Bu{constructor(t,e,n,r,s,i,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new Bu(t,e,Fu.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ea(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class ju{constructor(){this.q_=void 0,this.Q_=[]}}class qu{constructor(){this.queries=new Ca((t=>ba(t)),Ea),this.onlineState="Unknown",this.K_=new Set}}function $u(t,e){const n=gi(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.Q_)e.W_(t)&&(r=!0);s.q_=t}}r&&Ku(n)}function zu(t,e,n){const r=gi(t),s=r.queries.get(e);if(s)for(const t of s.Q_)t.onError(n);r.queries.delete(e)}function Ku(t){t.K_.forEach((t=>{t.next()}))}class Gu{constructor(t,e,n){this.query=t,this.G_=e,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Bu(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.z_?this.H_(t)&&(this.G_.next(t),e=!0):this.J_(t,this.onlineState)&&(this.Y_(t),e=!0),this.j_=t,e}onError(t){this.G_.error(t)}U_(t){this.onlineState=t;let e=!1;return this.j_&&!this.z_&&this.J_(this.j_,t)&&(this.Y_(this.j_),e=!0),e}J_(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Z_||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}H_(t){if(t.docChanges.length>0)return!0;const e=this.j_&&this.j_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Y_(t){t=Bu.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.z_=!0,this.G_.next(t)}}class Hu{constructor(t){this.key=t}}class Qu{constructor(t){this.key=t}}class Wu{constructor(t,e){this.query=t,this.oa=e,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=Va(),this.mutatedKeys=Va(),this.ua=Sa(t),this.ca=new Fu(this.ua)}get la(){return this.oa}ha(t,e){const n=e?e.Pa:new Uu,r=e?e.ca:this.ca;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const h=r.get(t),u=Ta(this.query,e)?e:null,l=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;h&&u?h.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this.Ia(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.ua(u,a)>0||c&&this.ua(u,c)<0)&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||c)&&(o=!0)),f&&(u?(i=i.add(u),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{ca:i,Pa:n,Xi:o,mutatedKeys:s}}Ia(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const s=this.ca;this.ca=t.ca,this.mutatedKeys=t.mutatedKeys;const i=t.Pa.k_();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fi()}};return n(t)-n(e)}(t.type,e.type)||this.ua(t.doc,e.doc))),this.Ta(n),r=null!=r&&r;const o=e&&!r?this.Ea():[],a=0===this.aa.size&&this.current&&!r?1:0,c=a!==this._a;return this._a=a,0!==i.length||c?{snapshot:new Bu(this.query,t.ca,s,i,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:o}:{da:o}}U_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new Uu,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(t){return!this.oa.has(t)&&!!this.ca.has(t)&&!this.ca.get(t).hasLocalMutations}Ta(t){t&&(t.addedDocuments.forEach((t=>this.oa=this.oa.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.oa=this.oa.delete(t))),this.current=t.current)}Ea(){if(!this.current)return[];const t=this.aa;this.aa=Va(),this.ca.forEach((t=>{this.Aa(t.key)&&(this.aa=this.aa.add(t.key))}));const e=[];return t.forEach((t=>{this.aa.has(t)||e.push(new Qu(t))})),this.aa.forEach((n=>{t.has(n)||e.push(new Hu(n))})),e}Ra(t){this.oa=t.hs,this.aa=Va();const e=this.ha(t.documents);return this.applyChanges(e,!0)}Va(){return Bu.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class Xu{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Yu{constructor(t){this.key=t,this.ma=!1}}class Ju{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.fa={},this.ga=new Ca((t=>ba(t)),Ea),this.pa=new Map,this.ya=new Set,this.wa=new oo(Vi.comparator),this.Sa=new Map,this.ba=new Ch,this.Da={},this.Ca=new Map,this.va=Eh.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function Zu(t,e){const n=function(t){const e=gi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=el.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=rl.bind(null,e),e.fa.u_=$u.bind(null,e.eventManager),e.fa.xa=zu.bind(null,e.eventManager),e}(t);let r,s;const i=n.ga.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Va();else{const t=await function(t,e){const n=gi(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Qr.getTargetData(t,e).next((s=>s?(r=s,zi.resolve(r)):n.Qr.allocateTargetId(t).next((s=>(r=new fh(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ns.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}(n.localStore,va(e)),i=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,s=await async function(t,e,n,r,s){t.Ma=(e,n,r)=>async function(t,e,n,r){let s=e.view.ha(n);s.Xi&&(s=await $h(t.localStore,e.query,!1).then((({documents:t})=>e.view.ha(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(s,t.isPrimaryClient,i,o);return ul(t,e.targetId,a.da),a.snapshot}(t,e,n,r);const i=await $h(t.localStore,e,!0),o=new Wu(e,i.hs),a=o.ha(i.documents),c=Nc.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),h=o.applyChanges(a,t.isPrimaryClient,c);ul(t,n,h.da);const u=new Xu(e,n,o);return t.ga.set(e,u),t.pa.has(n)?t.pa.get(n).push(e):t.pa.set(n,[e]),h.snapshot}(n,e,r,"current"===i,t.resumeToken),n.isPrimaryClient&&lu(n.remoteStore,t)}return s}async function tl(t,e){const n=gi(t),r=n.ga.get(e),s=n.pa.get(r.targetId);if(s.length>1)return n.pa.set(r.targetId,s.filter((t=>!Ea(t,e)))),void n.ga.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await qh(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),du(n.remoteStore,r.targetId),cl(n,r.targetId)})).catch($i)):(cl(n,r.targetId),await qh(n.localStore,r.targetId,!0))}async function el(t,e){const n=gi(t);try{const t=await function(t,e){const n=gi(t),r=e.snapshotVersion;let s=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.os.newChangeBuffer({trackRemovals:!0});s=n.ns;const o=[];e.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,i.addedDocuments,a))));let h=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?h=h.withResumeToken(po.EMPTY_BYTE_STRING,Ri.min()).withLastLimboFreeSnapshotVersion(Ri.min()):i.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(i.resumeToken,r)),s=s.insert(a,h),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,h,i)&&o.push(n.Qr.updateTargetData(t,h))}));let a=Da(),c=Va();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=Va(),s=Va();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Da();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(Ri.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):hi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{cs:r,ls:s}}))}(t,i,e.documentUpdates).next((t=>{a=t.cs,c=t.ls}))),!r.isEqual(Ri.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return zi.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ns=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Sa.get(e);r&&(pi(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.ma=!0:t.modifiedDocuments.size>0?pi(r.ma):t.removedDocuments.size>0&&(pi(r.ma),r.ma=!1))})),await fl(n,t,e)}catch(t){await $i(t)}}function nl(t,e,n){const r=gi(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.ga.forEach(((n,r)=>{const s=r.view.U_(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=gi(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.Q_)t.U_(e)&&(r=!0)})),r&&Ku(n)}(r.eventManager,e),t.length&&r.fa.u_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function rl(t,e,n){const r=gi(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Sa.get(e),i=s&&s.key;if(i){let t=new oo(Vi.comparator);t=t.insert(i,jo.newNoDocument(i,Ri.min()));const n=Va().add(i),s=new Dc(Ri.min(),new Map,new oo(Ni),t,n);await el(r,s),r.wa=r.wa.remove(i),r.Sa.delete(e),dl(r)}else await qh(r.localStore,e,!1).then((()=>cl(r,e,n))).catch($i)}async function sl(t,e){const n=gi(t),r=e.batch.batchId;try{const t=await function(t,e){const n=gi(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.os.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=zi.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);pi(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=Va();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);al(n,r,null),ol(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await fl(n,t)}catch(t){await $i(t)}}async function il(t,e,n){const r=gi(t);try{const t=await function(t,e){const n=gi(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(pi(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);al(r,e,n),ol(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await fl(r,t)}catch(n){await $i(n)}}function ol(t,e){(t.Ca.get(e)||[]).forEach((t=>{t.resolve()})),t.Ca.delete(e)}function al(t,e,n){const r=gi(t);let s=r.Da[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.Da[r.currentUser.toKey()]=s}}function cl(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.pa.get(e))t.ga.delete(r),n&&t.fa.xa(r,n);t.pa.delete(e),t.isPrimaryClient&&t.ba.Vr(e).forEach((e=>{t.ba.containsKey(e)||hl(t,e)}))}function hl(t,e){t.ya.delete(e.path.canonicalString());const n=t.wa.get(e);null!==n&&(du(t.remoteStore,n),t.wa=t.wa.remove(e),t.Sa.delete(n),dl(t))}function ul(t,e,n){for(const r of n)r instanceof Hu?(t.ba.addReference(r.key,e),ll(t,r)):r instanceof Qu?(hi("SyncEngine","Document no longer in limbo: "+r.key),t.ba.removeReference(r.key,e),t.ba.containsKey(r.key)||hl(t,r.key)):fi()}function ll(t,e){const n=e.key,r=n.path.canonicalString();t.wa.get(n)||t.ya.has(r)||(hi("SyncEngine","New document in limbo: "+n),t.ya.add(r),dl(t))}function dl(t){for(;t.ya.size>0&&t.wa.size<t.maxConcurrentLimboResolutions;){const e=t.ya.values().next().value;t.ya.delete(e);const n=new Vi(Oi.fromString(e)),r=t.va.next();t.Sa.set(r,new Yu(n)),t.wa=t.wa.insert(n,r),lu(t.remoteStore,new fh(va(ga(n.path)),r,"TargetPurposeLimboResolution",to._e))}}async function fl(t,e,n){const r=gi(t),s=[],i=[],o=[];r.ga.isEmpty()||(r.ga.forEach(((t,a)=>{o.push(r.Ma(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=Mh.Ki(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.fa.u_(s),await async function(t,e){const n=gi(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>zi.forEach(e,(e=>zi.forEach(e.qi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>zi.forEach(e.Qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Wi(t))throw t;hi("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,s)}}}(r.localStore,i))}async function pl(t,e){const n=gi(t);if(!n.currentUser.isEqual(e)){hi("SyncEngine","User change. New user:",e.toKey());const t=await Uh(n.localStore,e);n.currentUser=e,function(t,e){t.Ca.forEach((t=>{t.forEach((t=>{t.reject(new yi(mi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ca.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await fl(n,t.us)}}function gl(t,e){const n=gi(t),r=n.Sa.get(e);if(r&&r.ma)return Va().add(r.key);{let t=Va();const r=n.pa.get(e);if(!r)return t;for(const e of r){const r=n.ga.get(e);t=t.unionWith(r.view.la)}return t}}function ml(t){const e=gi(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=sl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=il.bind(null,e),e}class yl{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=eu(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new Fh(t,e,n,r)}(this.persistence,new Vh,t.initialUser,this.serializer)}createPersistence(t){return new Rh(Oh.Hr,this.serializer)}createSharedClientState(t){return new Kh}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class vl{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>nl(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=pl.bind(null,this.syncEngine),await async function(t,e){const n=gi(t);e?(n.v_.delete(2),await hu(n)):e||(n.v_.add(2),await uu(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new qu}createDatastore(t){const e=eu(t.databaseInfo.databaseId),n=function(t){return new Zh(t)}(t.databaseInfo);return function(t,e,n,r){return new ou(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,s){return new cu(t,e,n,r,s)}(this.localStore,this.datastore,t.asyncQueue,(t=>nl(this.syncEngine,t,0)),Hh.D()?new Hh:new Gh)}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new Ju(t,e,n,r,s,i);return o&&(a.Fa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=gi(t);hi("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await uu(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class wl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ba(this.observer.next,t)}error(t){this.observer.error?this.Ba(this.observer.error,t):ui("Uncaught Error in snapshot listener:",t.toString())}La(){this.muted=!0}Ba(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class El{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=ii.UNAUTHENTICATED,this.clientId=Di.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{hi("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(hi("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new yi(mi.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new vi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Vu(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function bl(t,e){t.asyncQueue.verifyOperationInProgress(),hi("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Uh(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function _l(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){hi("FirestoreClient","Using user provided OfflineComponentProvider");try{await bl(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===mi.FAILED_PRECONDITION||t.code===mi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;li("Error using user provided cache. Falling back to memory cache: "+n),await bl(t,new yl)}}else hi("FirestoreClient","Using default OfflineComponentProvider"),await bl(t,new yl);return t._offlineComponents}(t);hi("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Lu(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Lu(e.remoteStore,n))),t._onlineComponents=e}async function Tl(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(hi("FirestoreClient","Using user provided OnlineComponentProvider"),await _l(t,t._uninitializedComponentsProvider._online)):(hi("FirestoreClient","Using default OnlineComponentProvider"),await _l(t,new vl))),t._onlineComponents}async function Sl(t){const e=await Tl(t),n=e.eventManager;return n.onListen=Zu.bind(null,e.syncEngine),n.onUnlisten=tl.bind(null,e.syncEngine),n}function Il(t,e,n={}){const r=new vi;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new wl({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=gi(t),r=e.query;let s=!1;const i=n.queries.get(r);if(i){const t=i.Q_.indexOf(e);t>=0&&(i.Q_.splice(t,1),s=0===i.Q_.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}(t,o))),n.fromCache&&"server"===r.source?s.reject(new yi(mi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new Gu(n,i,{includeMetadataChanges:!0,Z_:!0});return async function(t,e){const n=gi(t),r=e.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new ju),s)try{i.q_=await n.onListen(r)}catch(t){const n=Vu(t,`Initialization of query '${_a(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.Q_.push(e),e.U_(n.onlineState),i.q_&&e.W_(i.q_)&&Ku(n)}(t,o)}(await Sl(t),t.asyncQueue,e,n,r))),r.promise}function Cl(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Al=new Map;function Dl(t,e,n){if(!n)throw new yi(mi.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Nl(t){if(!Vi.isDocumentKey(t))throw new yi(mi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function kl(t){if(Vi.isDocumentKey(t))throw new yi(mi.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function xl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":fi()}function Rl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new yi(mi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=xl(t);throw new yi(mi.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Ll{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new yi(mi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new yi(mi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new yi(mi.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Cl(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new yi(mi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new yi(mi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new yi(mi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Ol{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ll({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new yi(mi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new yi(mi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ll(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Ei;switch(t.type){case"firstParty":return new Si(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new yi(mi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Al.get(t);e&&(hi("ComponentProvider","Removing Datastore"),Al.delete(t),e.terminate())}(this),Promise.resolve()}}class Ml{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Ml(this.firestore,t,this._query)}}class Pl{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vl(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Pl(this.firestore,t,this._key)}}class Vl extends Ml{constructor(t,e,n){super(t,e,ga(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Pl(this.firestore,null,new Vi(t))}withConverter(t){return new Vl(this.firestore,t,this._path)}}function Fl(t,e,...n){if(t=g(t),Dl("collection","path",e),t instanceof Ol){const r=Oi.fromString(e,...n);return kl(r),new Vl(t,null,r)}{if(!(t instanceof Pl||t instanceof Vl))throw new yi(mi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Oi.fromString(e,...n));return kl(r),new Vl(t.firestore,null,r)}}class Ul{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new nu(this,"async_queue_retry"),this._u=()=>{const t=tu();t&&hi("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const t=tu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.au(),this.uu(t)}enterRestrictedMode(t){if(!this.tu){this.tu=!0,this.su=t||!1;const e=tu();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._u)}}enqueue(t){if(this.au(),this.tu)return new Promise((()=>{}));const e=new vi;return this.uu((()=>this.tu&&this.su?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.eu.push(t),this.cu())))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(t){if(!Wi(t))throw t;hi("AsyncQueue","Operation failed with retryable error: "+t)}this.eu.length>0&&this.jo.qo((()=>this.cu()))}}uu(t){const e=this.Xa.then((()=>(this.iu=!0,t().catch((t=>{this.ru=t,this.iu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw ui("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.iu=!1,t))))));return this.Xa=e,e}enqueueAfterDelay(t,e,n){this.au(),this.ou.indexOf(t)>-1&&(e=0);const r=Pu.createAndSchedule(this,t,e,n,(t=>this.lu(t)));return this.nu.push(r),r}au(){this.ru&&fi()}verifyOperationInProgress(){}async hu(){let t;do{t=this.Xa,await t}while(t!==this.Xa)}Pu(t){for(const e of this.nu)if(e.timerId===t)return!0;return!1}Iu(t){return this.hu().then((()=>{this.nu.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.nu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.hu()}))}Tu(t){this.ou.push(t)}lu(t){const e=this.nu.indexOf(t);this.nu.splice(e,1)}}class Bl extends Ol{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Ul,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||ql(this),this._firestoreClient.terminate()}}function jl(t){return t._firestoreClient||ql(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function ql(t){var e,n,r;const s=t._freezeSettings(),i=function(t,e,n,r){return new _o(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Cl(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new El(t._authCredentials,t._appCheckCredentials,t._queue,i),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class $l{constructor(t){this._byteString=t}static fromBase64String(t){try{return new $l(po.fromBase64String(t))}catch(t){throw new yi(mi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new $l(po.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class zl{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new yi(mi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pi(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Kl{constructor(t){this._methodName=t}}class Gl{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new yi(mi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new yi(mi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Ni(this._lat,t._lat)||Ni(this._long,t._long)}}const Hl=/^__.*__$/;class Ql{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new uc(t,this.data,this.fieldMask,e,this.fieldTransforms):new hc(t,this.data,e,this.fieldTransforms)}}function Wl(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fi()}}class Xl{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Eu(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(t){return new Xl(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Au({path:n,Vu:!1});return r.mu(t),r}fu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Au({path:n,Vu:!1});return r.Eu(),r}gu(t){return this.Au({path:void 0,Vu:!0})}pu(t){return ad(t,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Eu(){if(this.path)for(let t=0;t<this.path.length;t++)this.mu(this.path.get(t))}mu(t){if(0===t.length)throw this.pu("Document fields must not be empty");if(Wl(this.du)&&Hl.test(t))throw this.pu('Document fields cannot begin and end with "__"')}}class Yl{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||eu(t)}Su(t,e,n,r=!1){return new Xl({du:t,methodName:e,wu:n,path:Pi.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Jl(t){const e=t._freezeSettings(),n=eu(t._databaseId);return new Yl(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Zl(t,e,n,r,s,i={}){const o=t.Su(i.merge||i.mergeFields?2:0,e,n,s);rd("Data must be an object, but it was:",o,r);const a=ed(r,o);let c,h;if(i.merge)c=new lo(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=sd(e,r,n);if(!o.contains(s))throw new yi(mi.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);cd(t,s)||t.push(s)}c=new lo(t),h=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,h=o.fieldTransforms;return new Ql(new Uo(a),c,h)}function td(t,e){if(nd(t=g(t)))return rd("Unsupported field value:",e,t),ed(t,e);if(t instanceof Kl)return function(t,e){if(!Wl(e.du))throw e.pu(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.pu(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Vu&&4!==e.du)throw e.pu("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=td(s,e.gu(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=g(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ja(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=xi.fromDate(t);return{timestampValue:qc(e.serializer,n)}}if(t instanceof xi){const n=new xi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:qc(e.serializer,n)}}if(t instanceof Gl)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof $l)return{bytesValue:$c(e.serializer,t._byteString)};if(t instanceof Pl){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.pu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Gc(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.pu(`Unsupported field value: ${xl(t)}`)}(t,e)}function ed(t,e){const n={};return io(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):so(t,((t,r)=>{const s=td(r,e.Ru(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function nd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof xi||t instanceof Gl||t instanceof $l||t instanceof Pl||t instanceof Kl)}function rd(t,e,n){if(!nd(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=xl(n);throw"an object"===r?e.pu(t+" a custom object"):e.pu(t+" "+r)}}function sd(t,e,n){if((e=g(e))instanceof zl)return e._internalPath;if("string"==typeof e)return od(t,e);throw ad("Field path arguments must be of type string or ",t,!1,void 0,n)}const id=new RegExp("[~\\*/\\[\\]]");function od(t,e,n){if(e.search(id)>=0)throw ad(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new zl(...e.split("."))._internalPath}catch(r){throw ad(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function ad(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new yi(mi.INVALID_ARGUMENT,a+t+c)}function cd(t,e){return t.some((t=>t.isEqual(e)))}class hd{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Pl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new ud(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(ld("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class ud extends hd{data(){return super.data()}}function ld(t,e){return"string"==typeof e?od(t,e):e instanceof zl?e._internalPath:e._delegate._internalPath}class dd{convertValue(t,e="none"){switch(Io(t)){case 0:return null;case 1:return t.booleanValue;case 2:return yo(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(vo(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw fi()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return so(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Gl(yo(t.latitude),yo(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Eo(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(bo(t));default:return null}}convertTimestamp(t){const e=mo(t);return new xi(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Oi.fromString(t);pi(dh(n));const r=new To(n.get(1),n.get(3)),s=new Vi(n.popFirst(5));return r.isEqual(e)||ui(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}class fd{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class pd extends hd{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new gd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(ld("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class gd extends pd{data(t={}){return super.data(t)}}class md{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new fd(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new gd(this._firestore,this._userDataWriter,n.key,n,new fd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new yi(mi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new gd(t._firestore,t._userDataWriter,n.doc.key,n.doc,new fd(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new gd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new fd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:yd(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function yd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fi()}}class vd extends dd{constructor(t){super(),this.firestore=t}convertBytes(t){return new $l(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Pl(this.firestore,null,e)}}function wd(t,e){const n=Rl(t.firestore,Bl),r=function(t,e,...n){if(t=g(t),1===arguments.length&&(e=Di.newId()),Dl("doc","path",e),t instanceof Ol){const r=Oi.fromString(e,...n);return Nl(r),new Pl(t,null,new Vi(r))}{if(!(t instanceof Pl||t instanceof Vl))throw new yi(mi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Oi.fromString(e,...n));return Nl(r),new Pl(t.firestore,t instanceof Vl?t.converter:null,new Vi(r))}}(t),s=function(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}(t.converter,e);return function(t,e){return function(t,e){const n=new vi;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=ml(t);try{const t=await function(t,e){const n=gi(t),r=xi.now(),s=e.reduce(((t,e)=>t.add(e.key)),Va());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Da(),c=Va();return n.os.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{i=s;const o=[];for(const t of e){const e=ac(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new uc(t.key,e,Bo(e.value.mapValue),ec.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:xa(i)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Da[t.currentUser.toKey()];r||(r=new oo(Ni)),r=r.insert(e,n),t.Da[t.currentUser.toKey()]=r}(r,t.batchId,n),await fl(r,t.changes),await Su(r.remoteStore)}catch(t){const e=Vu(t,"Failed to persist write");n.reject(e)}}(await function(t){return Tl(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(jl(t),e)}(n,[Zl(Jl(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,ec.exists(!1))]).then((()=>r))}new WeakMap,function(t,e=!0){oi="10.7.2",Tt(new m("firestore",((t,{instanceIdentifier:n,options:r})=>{const s=t.getProvider("app").getImmediate(),i=new Bl(new _i(t.getProvider("auth-internal")),new Ci(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new yi(mi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new To(t.options.projectId,e)}(s,n),s);return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),At(si,"4.4.1",t),At(si,"4.4.1","esm2017")}();var Ed=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};const bd=function(t,e){const n="string"==typeof t?t:"(default)",r=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}("object"==typeof t?t:function(t=vt){const e=Et.get(t);if(!e&&t===vt&&o())return Ct();if(!e)throw St.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=i())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var i;const o=(t=Rl(t,Ol))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&li("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=ii.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new yi(mi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new ii(o)}t._authCredentials=new bi(new wi(e,n))}}(r,...t)}return r}(Ct({apiKey:"AIzaSyDblKMSaGR3l3VUP8Gcylpskcio8hM7cdQ",authDomain:"vanguard-35d26.firebaseapp.com",projectId:"vanguard-35d26",storageBucket:"vanguard-35d26.appspot.com",messagingSenderId:"187651490470",appId:"1:187651490470:web:f995465153247e0d556a67",measurementId:"G-Q75K0PGBWK"})),_d=()=>Ed(void 0,void 0,void 0,(function*(){const t=yield function(t){t=Rl(t,Ml);const e=Rl(t.firestore,Bl),n=jl(e),r=new vd(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new yi(mi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),Il(n,t._query).then((n=>new md(e,r,t,n)))}(Fl(bd,"songs")),e=[];return t.forEach((t=>{const n=t.data();e.push(Object.assign({id:t.id},n))})),e}));var Td,Sd=n(171);!function(t){t.image="image",t.title="Title",t.autor="autor",t.album="album",t.Dateadded="Dateadded",t.duration="duration"}(Td||(Td={}));class Id extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.keys({image:null,Title:null,autor:null,album:null,Dateadded:null,duration:null})}attributeChangedCallback(t,e,n){t===Td.duration?this.duration=n?Number(n):void 0:this[t]=n}connectedCallback(){this.render()}render(){var t;this.shadowRoot&&(this.shadowRoot.innerHTML=`\n    <img src="${this.image}" alt="Portada de un album">\n    <h2>${this.title}</h2>\n    <p>Autor: ${this.autor}</p>\n    <p>lbum: ${this.album}</p>\n    <p>Fecha aadida: ${this.Dateadded} </p>\n    <p>Duracin: ${this.duration} s</p>\n    `);const e=this.ownerDocument.createElement("style");e.innerHTML=Sd.A,null===(t=this.shadowRoot)||void 0===t||t.appendChild(e)}}customElements.define("app-song",Id);var Cd=n(523);const Ad={image:"",Title:"",autor:"",album:"",Dateadded:"",duration:0};class Dd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){return function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){var t,e,n,r,s,i,o,a,c,h;const u=this.ownerDocument.createElement("h1");u.innerText="Aade una cancin",null===(t=this.shadowRoot)||void 0===t||t.appendChild(u);const l=this.ownerDocument.createElement("input");l.type="url",l.placeholder="Portada (url)",l.addEventListener("change",this.addImage),null===(e=this.shadowRoot)||void 0===e||e.appendChild(l);const d=this.ownerDocument.createElement("input");d.placeholder="Ttulo",d.addEventListener("change",this.addTitle),null===(n=this.shadowRoot)||void 0===n||n.appendChild(d);const f=this.ownerDocument.createElement("input");f.placeholder="Autor",f.addEventListener("change",this.addAutor),null===(r=this.shadowRoot)||void 0===r||r.appendChild(f);const p=this.ownerDocument.createElement("input");p.placeholder="Album",p.addEventListener("change",this.addAlbum),null===(s=this.shadowRoot)||void 0===s||s.appendChild(p);const g=this.ownerDocument.createElement("label");g.id="date",g.innerText="Fecha";const m=this.ownerDocument.createElement("input");m.id="date",m.type="date",m.placeholder="Fecha de lanzamiento",m.addEventListener("change",this.addDateadded),null===(i=this.shadowRoot)||void 0===i||i.appendChild(g),null===(o=this.shadowRoot)||void 0===o||o.appendChild(m);const y=this.ownerDocument.createElement("input");y.type="number",y.placeholder="Duracin (s)",y.addEventListener("change",this.addDuration),null===(a=this.shadowRoot)||void 0===a||a.appendChild(y);const v=this.ownerDocument.createElement("button");v.innerHTML="Guardar cancin",v.addEventListener("click",this.submitForm),null===(c=this.shadowRoot)||void 0===c||c.appendChild(v);const w=document.createElement("section");(yield _d()).forEach((t=>{var e;const n=document.createElement("app-song");n.setAttribute(Td.image,t.image),n.setAttribute(Td.title,t.Title),n.setAttribute(Td.autor,t.autor),n.setAttribute(Td.album,t.album),n.setAttribute(Td.Dateadded,t.Dateadded),n.setAttribute(Td.duration,JSON.stringify(t.duration)),w.appendChild(n),null===(e=this.shadowRoot)||void 0===e||e.appendChild(w)}));const E=this.ownerDocument.createElement("style");E.innerHTML=Cd.A,null===(h=this.shadowRoot)||void 0===h||h.appendChild(E)}))}addImage(t){var e;Ad.image=null===(e=t.target)||void 0===e?void 0:e.value}addTitle(t){var e;Ad.Title=null===(e=t.target)||void 0===e?void 0:e.value}addAutor(t){var e;Ad.autor=null===(e=t.target)||void 0===e?void 0:e.value}addAlbum(t){var e;Ad.album=null===(e=t.target)||void 0===e?void 0:e.value}addDateadded(t){var e;Ad.Dateadded=null===(e=t.target)||void 0===e?void 0:e.value}addDuration(t){var e;Ad.duration=parseFloat(null===(e=t.target)||void 0===e?void 0:e.value)}submitForm(){(t=>{Ed(void 0,void 0,void 0,(function*(){try{yield wd(Fl(bd,"songs"),t)}catch(t){console.error("Error adding documents: ")}}))})(Ad)}}customElements.define("app-container",Dd)})()})();